/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var E=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var M=(m,c)=>{for(var t in c)E(m,t,{get:c[t],enumerable:!0})},$=(m,c,t,e)=>{if(c&&typeof c=="object"||typeof c=="function")for(let s of I(c))!N.call(m,s)&&s!==t&&E(m,s,{get:()=>c[s],enumerable:!(e=D(c,s))||e.enumerable});return m};var F=m=>$(E({},"__esModule",{value:!0}),m);var R={};M(R,{default:()=>T});module.exports=F(R);var d=require("obsidian");var C=require("obsidian"),S=class{constructor(c){this.cachedPrompts=[];this.lastFetchTime=0;this.CACHE_DURATION=24*60*60*1e3;this.CACHE_FILE=".writing-momentum/network-prompts.json";this.promptSources=[{name:"Writing Prompts Reddit",url:"https://www.reddit.com/r/WritingPrompts/hot.json?limit=50",selector:"json",transform:c=>{try{let t=JSON.parse(c),e=[];if(t.data&&t.data.children){for(let s of t.data.children)if(s.data&&s.data.title){let n=s.data.title;n=n.replace(/^\[.*?\]\s*/,""),n=n.trim(),n.length>20&&n.length<200&&e.push(n)}}return e}catch(t){return console.error("Error parsing Reddit JSON:",t),[]}}}];this.plugin=c,this.loadCachedPrompts()}async loadCachedPrompts(){try{let c=this.plugin.app.vault.getAbstractFileByPath(this.CACHE_FILE);if(c instanceof C.TFile){let t=await this.plugin.app.vault.read(c),e=JSON.parse(t);e.prompts&&Array.isArray(e.prompts)&&(this.cachedPrompts=e.prompts,this.lastFetchTime=e.timestamp||0)}}catch(c){console.log("No cached prompts found or error loading cache:",c)}}async saveCachedPrompts(){try{let c={prompts:this.cachedPrompts,timestamp:this.lastFetchTime},t=".writing-momentum";await this.plugin.app.vault.adapter.exists(t)||await this.plugin.app.vault.createFolder(t);let s=this.plugin.app.vault.getAbstractFileByPath(this.CACHE_FILE);s instanceof C.TFile?await this.plugin.app.vault.modify(s,JSON.stringify(c,null,2)):await this.plugin.app.vault.create(this.CACHE_FILE,JSON.stringify(c,null,2))}catch(c){console.error("Error saving cached prompts:",c)}}async fetchNetworkPrompts(){let c=Date.now();if(this.cachedPrompts.length>0&&c-this.lastFetchTime<this.CACHE_DURATION)return this.cachedPrompts;try{let t=[];for(let e of this.promptSources)try{let s=await this.fetchFromSource(e);t.push(...s)}catch(s){console.error(`Error fetching from ${e.name}:`,s)}if(t.length>0){let e=[...new Set(t)].filter(s=>s.length>10&&s.length<300).slice(0,100);this.cachedPrompts=e,this.lastFetchTime=c,await this.saveCachedPrompts()}return this.cachedPrompts}catch(t){return console.error("Error fetching network prompts:",t),this.cachedPrompts}}async fetchFromSource(c){try{let t=await fetch(c.url,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);let e=await t.text();if(c.transform){let s=c.transform(e);return Array.isArray(s)?s:[]}return this.extractPromptsFromHTML(e,c.selector)}catch(t){return console.error(`Error fetching from ${c.name}:`,t),[]}}extractPromptsFromHTML(c,t){let e=[];try{new DOMParser().parseFromString(c,"text/html").querySelectorAll(t).forEach(o=>{var l;let i=(l=o.textContent)==null?void 0:l.trim();i&&i.length>10&&i.length<300&&e.push(i)})}catch(s){console.error("Error parsing HTML:",s)}return e}getRandomNetworkPrompt(){if(this.cachedPrompts.length===0)return null;let c=Math.floor(Math.random()*this.cachedPrompts.length);return this.cachedPrompts[c]}async refreshPrompts(){return this.lastFetchTime=0,(await this.fetchNetworkPrompts()).length>0}getCachedPromptsCount(){return this.cachedPrompts.length}getLastFetchTime(){return this.lastFetchTime>0?new Date(this.lastFetchTime):null}};var L={reminderTime:"21:00",showStatusBar:!0,showRibbonIcon:!0,enableNotifications:!0,defaultTitlePattern:"{{date}} - Writing Session",defaultTemplate:`# {{title}}

## Prompt
{{random_prompt}}

## Writing


---
*Written on {{weekday}} at {{time}}*`,continuousWriting:{enabled:!1,targetSessions:30,currentCount:0,sessionDuration:25},promptsFile:".writing-momentum/prompts.md",randomPrompts:{enabled:!1,mixWithLocal:!0,autoRefresh:!0}},b=["What if gravity worked backwards for one day?","Describe a world where colors have sounds","What would you tell your younger self?","If you could have dinner with any historical figure, who would it be and why?","Describe your perfect day in vivid detail","What's the most important lesson you learned recently?","What are you most grateful for right now?","What challenge are you currently facing and how might you overcome it?","What small thing brought you joy today?","What would you do if you weren't afraid?","The old book opened itself to a page that wasn't there yesterday...","She found a letter addressed to her, dated 50 years in the future...","The last person on Earth sat alone in a room. There was a knock at the door...","Every morning, the same stranger waves at you from their window...","You wake up with the ability to hear everyone's thoughts, except one person...","Write about: Transformation","Explore the theme: Hidden connections","Focus on: Unexpected kindness","Consider: The space between words","Reflect on: Moments of change","Describe what you can see from where you're sitting","What sounds do you notice right now?","Write about a memory triggered by a smell","Describe a person you saw today without using their appearance","What's the story behind an object near you?","Write about a time you felt completely understood","Describe the feeling of coming home","What does hope look like to you?","Write about a moment of unexpected courage","Describe the weight of a secret","If time had a texture, what would it feel like?","What color is Monday?","Describe the personality of your favorite room","What would loneliness say if it could speak?","Write about the space between heartbeats"],k=["Mystery","Journey","Discovery","Connection","Solitude","Courage","Change","Memory","Hope","Wonder","Silence","Movement","Light","Shadow","Time","Growth","Healing","Adventure","Home","Freedom","Dreams","Truth","Beauty","Strength","Peace"],T=class extends d.Plugin{constructor(){super(...arguments);this.statusBarItem=null;this.currentSession=null;this.sessionHistory=[];this.wordCountInterval=null}async onload(){console.log("Writing Momentum Plugin: Loading..."),await this.loadSettings(),await this.loadSessionHistory(),this.randomPrompts=new S(this),this.settings.randomPrompts.enabled&&this.settings.randomPrompts.autoRefresh&&this.randomPrompts.fetchNetworkPrompts().catch(t=>{console.log("Background random prompt fetch failed:",t)}),this.registerView(y,t=>new P(t,this)),this.settings.showRibbonIcon&&this.addRibbonIcon("target","Writing Momentum",()=>{this.openDashboard()}),this.settings.showStatusBar&&(this.statusBarItem=this.addStatusBarItem(),this.updateStatusBar()),this.addCommand({id:"open-dashboard",name:"Open Writing Dashboard",callback:()=>this.openDashboard()}),this.addCommand({id:"start-writing-session",name:"Start Writing Session",callback:()=>this.startQuickSession()}),this.addCommand({id:"complete-session",name:"Complete Writing Session",callback:()=>this.completeSession()}),this.addCommand({id:"quick-note",name:"Create Quick Note",callback:()=>this.createQuickNote()}),this.addCommand({id:"insert-writing-prompt",name:"Insert Writing Prompt",callback:()=>this.insertWritingPrompt()}),this.addCommand({id:"stop-all-timers",name:"Stop All Timers and Alarms",callback:()=>this.stopAllTimers()}),this.addSettingTab(new x(this.app,this)),this.registerEvent(this.app.workspace.on("file-open",t=>{t&&t.extension==="md"&&this.checkAutoStartSession(t)})),console.log("Writing Momentum Plugin: Loaded successfully!")}onunload(){this.stopAllTimers(),console.log("Writing Momentum Plugin: Unloaded")}stopAllTimers(){this.wordCountInterval&&(window.clearInterval(this.wordCountInterval),this.wordCountInterval=null),this.app.workspace.getLeavesOfType(y).forEach(e=>{let s=e.view;s&&s.stopRealTimeUpdates&&s.stopRealTimeUpdates()}),this.currentSession&&this.currentSession.active&&(console.log("Stopping active session due to timer shutdown"),this.completeSession()),console.log("All timers and alarms stopped")}async loadSettings(){this.settings=Object.assign({},L,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}refreshDashboard(){let{workspace:t}=this.app,e=t.getLeavesOfType(y);if(e.length>0){let n=e[0].view;n&&n.render&&n.render()}}async loadSessionHistory(){let t=await this.loadData();t!=null&&t.sessionHistory&&(this.sessionHistory=t.sessionHistory)}async saveSessionHistory(){let t=await this.loadData()||{};t.sessionHistory=this.sessionHistory,await this.saveData(t)}getRandomPrompt(){if(this.settings.randomPrompts.enabled&&this.randomPrompts){let t=this.randomPrompts.getRandomNetworkPrompt();if(t)return this.settings.randomPrompts.mixWithLocal&&Math.random()<.5?b[Math.floor(Math.random()*b.length)]:t}return b[Math.floor(Math.random()*b.length)]}getRandomKeyword(){return k[Math.floor(Math.random()*k.length)]}async openDashboard(){let{workspace:t}=this.app,e=t.getLeavesOfType(y)[0];if(!e){let s=t.getRightLeaf(!1);s&&(e=s,await e.setViewState({type:y,active:!0}))}e&&t.revealLeaf(e)}startQuickSession(){let t=this.app.workspace.getActiveFile();t&&(this.currentSession||(this.currentSession={id:`session-${Date.now()}`,startTime:Date.now(),wordCount:0,active:!0,paused:!1,totalPausedDuration:0,filePath:t.path,date:new Date().toISOString().split("T")[0]},this.startWordCountTracking(),this.settings.enableNotifications,this.updateStatusBar(),this.refreshDashboard(),console.log("Session started:",this.currentSession.id)))}completeSession(){if(!this.currentSession)return;this.currentSession.active=!1,this.currentSession.endTime=Date.now();let t=Math.round((Date.now()-this.currentSession.startTime)/6e4);if(this.sessionHistory.push({...this.currentSession}),this.saveSessionHistory(),this.settings.continuousWriting.enabled){let e=this.settings.continuousWriting.sessionDuration;t>=e&&(this.settings.continuousWriting.currentCount++,this.saveSettings(),this.settings.continuousWriting.currentCount>=this.settings.continuousWriting.targetSessions&&this.settings.enableNotifications)}if(this.settings.enableNotifications){let e=`Session completed! ${this.currentSession.wordCount} words in ${t} minutes \u{1F389}`;if(this.settings.continuousWriting.enabled){let s=this.settings.continuousWriting.currentCount,n=this.settings.continuousWriting.sessionDuration;t>=n?e+=` Continuous session ${s} completed! \u{1F525}`:e+=` (Need ${n}+ minutes for continuous progress)`}}this.wordCountInterval&&(window.clearInterval(this.wordCountInterval),this.wordCountInterval=null),this.currentSession=null,this.updateStatusBar(),this.refreshDashboard(),console.log("Session completed")}pauseSession(){!this.currentSession||!this.currentSession.active||this.currentSession.paused||(this.currentSession.paused=!0,this.currentSession.pausedTime=Date.now(),this.wordCountInterval&&(window.clearInterval(this.wordCountInterval),this.wordCountInterval=null),this.settings.enableNotifications,this.updateStatusBar(),console.log("Session paused:",this.currentSession.id))}resumeSession(){!this.currentSession||!this.currentSession.active||!this.currentSession.paused||(this.currentSession.pausedTime&&(this.currentSession.totalPausedDuration+=Date.now()-this.currentSession.pausedTime),this.currentSession.paused=!1,this.currentSession.pausedTime=void 0,this.startWordCountTracking(),this.settings.enableNotifications,this.updateStatusBar(),console.log("Session resumed:",this.currentSession.id))}startWordCountTracking(){this.wordCountInterval&&window.clearInterval(this.wordCountInterval),this.wordCountInterval=window.setInterval(()=>{this.updateWordCount()},5e3),this.registerInterval(this.wordCountInterval)}async updateWordCount(){if(!this.currentSession)return;let t=this.app.vault.getAbstractFileByPath(this.currentSession.filePath);if(t instanceof d.TFile)try{let e=await this.app.vault.read(t),s=this.countWords(e);this.currentSession.wordCount=s,this.updateStatusBar()}catch(e){console.error("Failed to read file:",e)}}countWords(t){return t.replace(/^---[\s\S]*?---\n?/,"").trim().split(/\s+/).filter(s=>s.length>0).length}updateStatusBar(){if(this.statusBarItem)if(this.currentSession&&this.currentSession.active){let t=Date.now()-this.currentSession.startTime-this.currentSession.totalPausedDuration;this.currentSession.paused&&this.currentSession.pausedTime&&(t-=Date.now()-this.currentSession.pausedTime);let e=Math.round(t/6e4),s=this.currentSession.paused?" \u23F8\uFE0F":"";this.statusBarItem.setText(`\u270D\uFE0F ${this.currentSession.wordCount} words (${e}m)${s}`)}else this.statusBarItem.setText("\u{1F4DD} Ready to write")}checkAutoStartSession(t){}async createQuickNote(){let t=new Date,e=t.toISOString().split("T")[0],s=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(/:/g,"-"),n=`${e} Quick Note ${s}.md`,r=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),o=`# Quick Note - ${e}

What's on your mind?

---

Written at ${r}`;try{let i=n,l=1;for(;this.app.vault.getAbstractFileByPath(i);)i=`${n.replace(".md","")} (${l}).md`,l++;let a=await this.app.vault.create(i,o);await this.app.workspace.getLeaf().openFile(a),this.settings.enableNotifications,setTimeout(()=>this.startQuickSession(),100)}catch(i){console.error("Failed to create quick note:",i),new d.Notice(`Failed to create quick note: ${i.message}`)}}async createTemplateNoteAndStartSession(){let t=await this.showTemplateSelectionDialog();if(t)try{let e=this.processTemplate(t.title);console.log("Debug - Title pattern:",t.title),console.log("Debug - Processed title:",e);let s=this.processTemplate(t.template,e);console.log("Debug - Template pattern:",t.template),console.log("Debug - Final content:",s);let n=this.sanitizeFileName(e)+".md",r=n,o=1;for(;this.app.vault.getAbstractFileByPath(r);)r=`${n.replace(".md","")} (${o}).md`,o++;let i=await this.app.vault.create(r,s);await this.app.workspace.getLeaf().openFile(i),setTimeout(()=>{this.startQuickSession()},100),this.settings.enableNotifications}catch(e){console.error("Failed to create template note and start session:",e),new d.Notice(`Failed to create note: ${e.message}`)}}processTemplate(t,e){let s=new Date,n=s.toISOString().split("T")[0],r=s.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),o=s.toLocaleDateString("en-US",{weekday:"long"}),i=this.getRandomPrompt(),l=t.replace(/\{\{date\}\}/g,n).replace(/\{\{time\}\}/g,r).replace(/\{\{weekday\}\}/g,o).replace(/\{\{vault\}\}/g,this.app.vault.getName()).replace(/\{\{random_prompt\}\}/g,i);return e?l=l.replace(/\{\{title\}\}/g,e):l=l.replace(/\{\{title\}\}/g,"Writing Session"),l}sanitizeFileName(t){return t.replace(/[<>:"/\\|?*]/g,"-").replace(/\s+/g," ").trim()}async showTemplateSelectionDialog(){return new Promise(t=>{var o;let e=this.getAvailableTemplates(),s=document.createElement("div");s.className="modal-container",s.style.cssText=`
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0, 0, 0, 0.5);
				display: flex;
				align-items: center;
				justify-content: center;
				z-index: 1000;
			`;let n=document.createElement("div");n.className="template-selection-dialog",n.style.cssText=`
				background: var(--background-primary);
				border: 1px solid var(--background-modifier-border);
				border-radius: 12px;
				padding: 24px;
				max-width: 500px;
				width: 90%;
				max-height: 70vh;
				overflow-y: auto;
			`,n.innerHTML=`
				<h2 style="margin-top: 0; color: var(--text-accent);">Choose Writing Template</h2>
				<p style="color: var(--text-muted); margin-bottom: 20px;">Select a template to start your writing session:</p>
				<div class="template-options"></div>
				<div style="display: flex; gap: 12px; margin-top: 20px; justify-content: flex-end;">
					<button class="cancel-btn" style="padding: 8px 16px; border: 1px solid var(--background-modifier-border); background: var(--background-secondary); border-radius: 6px; cursor: pointer;">Cancel</button>
				</div>
			`;let r=n.querySelector(".template-options");e.forEach((i,l)=>{let a=document.createElement("div");a.className="template-option",a.style.cssText=`
					border: 1px solid var(--background-modifier-border);
					border-radius: 8px;
					padding: 16px;
					margin-bottom: 12px;
					cursor: pointer;
					transition: all 0.2s;
					background: var(--background-secondary);
				`,a.innerHTML=`
					<h3 style="margin: 0 0 8px 0; color: var(--text-accent);">${i.name}</h3>
					<p style="margin: 0; color: var(--text-muted); font-size: 0.9em;">${i.description}</p>
				`,a.addEventListener("mouseenter",()=>{a.style.borderColor="var(--interactive-accent)",a.style.backgroundColor="var(--background-primary)"}),a.addEventListener("mouseleave",()=>{a.style.borderColor="var(--background-modifier-border)",a.style.backgroundColor="var(--background-secondary)"}),a.addEventListener("click",()=>{document.body.removeChild(s),t(i)}),r==null||r.appendChild(a)}),(o=n.querySelector(".cancel-btn"))==null||o.addEventListener("click",()=>{document.body.removeChild(s),t(null)}),s.addEventListener("click",i=>{i.target===s&&(document.body.removeChild(s),t(null))}),s.appendChild(n),document.body.appendChild(s)})}getAvailableTemplates(){return[{name:"Daily Journal",description:"Structured daily reflection with prompts for events, feelings, and gratitude",title:"{{date}} - Daily Journal",template:`**\u{1F4DD} Today's Writing Session**
*Take a moment to reflect on your day and capture your thoughts.*

## Morning Reflection
{{random_prompt}}

## Today's Events
-
-
-

## Thoughts & Feelings


## Gratitude
1.
2.
3.

---
*Journal entry for {{weekday}}, {{date}} at {{time}}*`},{name:"Creative Writing",description:"Free-form creative writing with inspiration prompt",title:"{{date}} - Creative Writing",template:`**\u2728 Creative Writing Session**
*Let your imagination flow and create something beautiful.*

## Writing Prompt
{{random_prompt}}

## Your Story


---
*Creative session on {{weekday}} at {{time}}*`},{name:"Quick Notes",description:"Fast idea capture and organization",title:"{{time}} - Quick Note",template:`**\u{1F4A1} Quick Idea Capture**
*Capture your thoughts quickly and organize them for later.*

## Main Idea
{{random_prompt}}

## Details


## Next Steps
- [ ]
- [ ]

---
*Note taken {{weekday}} at {{time}}*`},{name:"Project Planning",description:"Structured project planning and task organization",title:"{{date}} - Project Planning",template:`**\u{1F3AF} Project Planning Session**
*Plan your project systematically and set clear goals.*

## Project Goal
{{random_prompt}}

## Overview
**Start Date:** {{date}}
**Status:** Planning

## Tasks
- [ ] Task 1
- [ ] Task 2
- [ ] Task 3

## Timeline


## Resources


---
*Project planned on {{weekday}}, {{date}} at {{time}}*`},{name:"Free Writing",description:"Unstructured writing for stream of consciousness",title:"{{date}} - Free Writing",template:`**\u{1F30A} Free Writing Session**
*Write without stopping, let your thoughts flow naturally.*

## Starting Thought
{{random_prompt}}

## Stream of Consciousness
Write continuously for your target time. Don't worry about grammar, structure, or making sense. Just let your thoughts flow onto the page.




---
*Free writing session {{weekday}} at {{time}}*`}]}async insertWritingPrompt(){let t=this.app.workspace.getActiveViewOfType(d.MarkdownView);if(!t){new d.Notice("No active note to insert prompt into");return}let e=this.getRandomPrompt(),s=[this.getRandomKeyword(),this.getRandomKeyword(),this.getRandomKeyword()],n=`**Writing Prompt:** ${e}

**Keywords:** ${s.join(", ")}

---

`,r=t.editor,o=r.getCursor();r.replaceRange(n,o);let i=n.split(`
`).length;r.setCursor(o.line+i-1,0),this.settings.enableNotifications}},x=class extends d.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Writing Momentum Settings"}),t.createEl("h3",{text:"Continuous Writing"});let e=new d.Setting(t).setName("Enable continuous writing mode").setDesc("Track consecutive writing sessions for extended focus periods").addToggle(a=>a.setValue(this.plugin.settings.continuousWriting.enabled).onChange(async u=>{this.plugin.settings.continuousWriting.enabled=u,await this.plugin.saveSettings(),this.display(),this.refreshDashboard()}));if(this.plugin.settings.continuousWriting.enabled){new d.Setting(t).setName("Target sessions").setDesc("Number of consecutive sessions to complete (e.g., 30 sessions)").addSlider(w=>w.setLimits(5,100,5).setValue(this.plugin.settings.continuousWriting.targetSessions).setDynamicTooltip().onChange(async v=>{this.plugin.settings.continuousWriting.targetSessions=v,await this.plugin.saveSettings()})),new d.Setting(t).setName("Session duration").setDesc("Minutes per continuous writing session").addSlider(w=>w.setLimits(10,60,5).setValue(this.plugin.settings.continuousWriting.sessionDuration).setDynamicTooltip().onChange(async v=>{this.plugin.settings.continuousWriting.sessionDuration=v,await this.plugin.saveSettings()})),new d.Setting(t).setName("Reset continuous writing counter").setDesc("Reset your current progress and start over").addButton(w=>w.setButtonText("Reset Counter").setClass("mod-warning").onClick(async()=>{this.plugin.settings.continuousWriting.currentCount=0,await this.plugin.saveSettings(),this.display(),this.refreshDashboard()}));let a=t.createDiv("continuous-writing-progress");a.createEl("h4",{text:"Current Progress"});let u=this.plugin.settings.continuousWriting.currentCount,p=this.plugin.settings.continuousWriting.targetSessions,h=a.createEl("p",{text:`${u} / ${p} sessions completed (${Math.round(u/p*100)}%)`,cls:"progress-text"}),f=a.createEl("div",{cls:"progress-bar-container"}).createEl("div",{cls:"progress-bar-fill"});f.style.width=`${Math.min(u/p*100,100)}%`}t.createEl("h3",{text:"General Settings"}),new d.Setting(t).setName("Reminder time").setDesc("Daily writing reminder (HH:MM format)").addText(a=>a.setPlaceholder("21:00").setValue(this.plugin.settings.reminderTime).onChange(async u=>{this.plugin.settings.reminderTime=u,await this.plugin.saveSettings()})),new d.Setting(t).setName("Show status bar").setDesc("Display writing progress in status bar").addToggle(a=>a.setValue(this.plugin.settings.showStatusBar).onChange(async u=>{this.plugin.settings.showStatusBar=u,await this.plugin.saveSettings(),u&&!this.plugin.statusBarItem?(this.plugin.statusBarItem=this.plugin.addStatusBarItem(),this.plugin.updateStatusBar()):!u&&this.plugin.statusBarItem&&(this.plugin.statusBarItem.remove(),this.plugin.statusBarItem=null)})),new d.Setting(t).setName("Show ribbon icon").setDesc("Display plugin icon in left ribbon").addToggle(a=>a.setValue(this.plugin.settings.showRibbonIcon).onChange(async u=>{this.plugin.settings.showRibbonIcon=u,await this.plugin.saveSettings()})),new d.Setting(t).setName("Enable notifications").setDesc("Show notifications for session events").addToggle(a=>a.setValue(this.plugin.settings.enableNotifications).onChange(async u=>{this.plugin.settings.enableNotifications=u,await this.plugin.saveSettings()})),t.createEl("h3",{text:"Random Prompts"});let s=new d.Setting(t).setName("Enable random prompts").setDesc("Fetch writing prompts from online sources (requires internet connection)").addToggle(a=>a.setValue(this.plugin.settings.randomPrompts.enabled).onChange(async u=>{this.plugin.settings.randomPrompts.enabled=u,await this.plugin.saveSettings(),this.display(),u&&this.plugin.randomPrompts&&await this.plugin.randomPrompts.fetchNetworkPrompts()}));if(this.plugin.settings.randomPrompts.enabled){new d.Setting(t).setName("Mix with local prompts").setDesc("Randomly mix random prompts with built-in prompts for variety").addToggle(p=>p.setValue(this.plugin.settings.randomPrompts.mixWithLocal).onChange(async h=>{this.plugin.settings.randomPrompts.mixWithLocal=h,await this.plugin.saveSettings()})),new d.Setting(t).setName("Auto-refresh prompts").setDesc("Automatically fetch new prompts daily (cached for offline use)").addToggle(p=>p.setValue(this.plugin.settings.randomPrompts.autoRefresh).onChange(async h=>{this.plugin.settings.randomPrompts.autoRefresh=h,await this.plugin.saveSettings()}));let a=new d.Setting(t).setName("Prompt cache status").setDesc("View and manage cached random prompts"),u=a.controlEl.createEl("button",{text:"Refresh Now",cls:"mod-cta"});u.onclick=async()=>{u.disabled=!0,u.textContent="Refreshing...";try{await this.plugin.randomPrompts.refreshPrompts()?new d.Notice("Random prompts refreshed successfully!"):new d.Notice("Failed to refresh prompts. Check your internet connection.")}catch(p){new d.Notice("Error refreshing prompts: "+p.message)}u.disabled=!1,u.textContent="Refresh Now",this.updatePromptStatus(a)},this.updatePromptStatus(a)}t.createEl("h3",{text:"Template Presets"});let n=[{name:"Daily Journal",title:"{{date}} - Daily Journal",template:`# Daily Journal - {{date}}

## Morning Reflection
{{random_prompt}}

## Today's Events
- 
- 
- 

## Thoughts & Feelings


## Gratitude
1. 
2. 
3. 

---
*Written on {{weekday}} at {{time}}*`},{name:"Quick Notes",title:"{{time}} - Quick Note",template:`# Quick Note

## Idea
{{random_prompt}}

## Details


## Next Steps
- [ ] 
- [ ] 

---
*{{weekday}} {{time}}*`},{name:"Project Planning",title:"Project - {{title}}",template:`# Project: {{title}}

## Goal
{{random_prompt}}

## Overview
**Start Date:** {{date}}
**Status:** Planning

## Tasks
- [ ] Task 1
- [ ] Task 2
- [ ] Task 3

## Timeline


## Resources


---
*Created {{weekday}}, {{date}} at {{time}}*`}],r,o;new d.Setting(t).setName("Template preset").setDesc("Choose a template to customize").addDropdown(a=>{a.addOption("custom","Custom Template"),n.forEach((p,h)=>{a.addOption(h.toString(),p.name)});let u=n.find(p=>p.title===this.plugin.settings.defaultTitlePattern&&p.template===this.plugin.settings.defaultTemplate);a.setValue(u?n.indexOf(u).toString():"custom"),a.onChange(p=>{if(p==="custom")return;let h=n[parseInt(p)];this.plugin.settings.defaultTitlePattern=h.title,this.plugin.settings.defaultTemplate=h.template,this.plugin.saveSettings(),this.display()})}),t.createEl("br"),t.createEl("h3",{text:"Page Title Pattern"});let i=t.createDiv("title-pattern-container");i.createEl("p",{text:"Pattern for new page titles. Use variables like {{date}}, {{time}}, {{title}}, etc.",cls:"title-pattern-description"}),r=i.createEl("input",{cls:"title-pattern-editor",attr:{type:"text",placeholder:"{{date}} - Writing Session"}}),r.value=this.plugin.settings.defaultTitlePattern||"{{date}} - Writing Session",r.addEventListener("input",async()=>{this.plugin.settings.defaultTitlePattern=r.value,await this.plugin.saveSettings()}),t.createEl("h3",{text:"Template Content Editor"});let l=t.createDiv("template-content-container");l.createEl("p",{text:"Edit your template content below. Use variables like {{date}}, {{time}}, {{random_prompt}}, etc.",cls:"template-content-description"}),o=l.createEl("textarea",{cls:"template-content-editor",attr:{placeholder:`# {{title}}

## Prompt
{{random_prompt}}

## Writing


---
*Written on {{weekday}} at {{time}}*`}}),o.value=this.plugin.settings.defaultTemplate||`# {{title}}

## Prompt
{{random_prompt}}

## Writing


---
*Written on {{weekday}} at {{time}}*`,o.addEventListener("input",async()=>{this.plugin.settings.defaultTemplate=o.value,await this.plugin.saveSettings()})}refreshDashboard(){let{workspace:t}=this.app,e=t.getLeavesOfType(y);if(e.length>0){let n=e[0].view;n&&n.render&&n.render()}}updatePromptStatus(t){if(!this.plugin.randomPrompts)return;let e=this.plugin.randomPrompts.getCachedPromptsCount(),s=this.plugin.randomPrompts.getLastFetchTime(),n=`${e} prompts cached`;if(s){let r=this.getTimeAgo(s);n+=` (last updated ${r})`}else n+=" (never fetched)";t.setDesc(n)}getTimeAgo(t){let s=new Date().getTime()-t.getTime(),n=Math.floor(s/(1e3*60)),r=Math.floor(n/60),o=Math.floor(r/24);return n<1?"just now":n<60?`${n} minute${n!==1?"s":""} ago`:r<24?`${r} hour${r!==1?"s":""} ago`:`${o} day${o!==1?"s":""} ago`}},y="writing-momentum-dashboard",P=class extends d.ItemView{constructor(t,e){super(t);this.updateInterval=null;this.plugin=e}getViewType(){return y}getDisplayText(){return"Writing Dashboard"}getIcon(){return"target"}async onOpen(){this.render(),this.startRealTimeUpdates()}async onClose(){this.stopRealTimeUpdates()}startRealTimeUpdates(){this.updateInterval=window.setInterval(()=>{this.updateRealTimeElements()},1e3),this.plugin.registerInterval(this.updateInterval)}stopRealTimeUpdates(){this.updateInterval&&(window.clearInterval(this.updateInterval),this.updateInterval=null)}updateRealTimeElements(){let t=this.containerEl.querySelector(".session-timer");if(t&&this.plugin.currentSession&&this.plugin.currentSession.active){let s=this.plugin.currentSession,n=Date.now()-s.startTime-s.totalPausedDuration;s.paused&&s.pausedTime&&(n-=Date.now()-s.pausedTime);let r=Math.floor(n/36e5),o=Math.floor(n%36e5/6e4),i=Math.floor(n%6e4/1e3),l=r>0?`${r}:${o.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`:`${o}:${i.toString().padStart(2,"0")}`;t.textContent=l}let e=this.containerEl.querySelector(".session-words");e&&this.plugin.currentSession&&this.plugin.currentSession.active&&(e.textContent=this.plugin.currentSession.wordCount.toString())}render(){let t=this.containerEl.children[1];t.empty(),t.addClass("writing-momentum-dashboard"),t.createEl("div",{cls:"dashboard-header"}).createEl("h2",{text:"Writing Dashboard",cls:"dashboard-title"}),this.renderCurrentSession(t),this.plugin.currentSession&&this.plugin.currentSession.active||(this.renderContinuousWriting(t),this.plugin.settings.continuousWriting.enabled||this.renderWritingMode(t)),this.renderWritingVolumeChart(t)}renderCurrentSession(t){let e=t.createEl("div",{cls:"dashboard-section"});if(this.plugin.currentSession&&this.plugin.currentSession.active){let s=this.plugin.currentSession,n=Date.now()-s.startTime-s.totalPausedDuration;s.paused&&s.pausedTime&&(n-=Date.now()-s.pausedTime);let r=Math.round(n/6e4),o=e.createEl("h3",{text:s.paused?"\u{1F3AF} Current Session (Paused)":"\u{1F3AF} Current Session"});s.paused&&o.addClass("paused-session");let i=e.createEl("div",{cls:"session-stats-grid"}),l=i.createEl("div",{cls:"stat-card"});l.createEl("span",{text:"\u{1F4DD}",cls:"stat-icon"}),l.createEl("span",{text:s.wordCount.toString(),cls:"stat-value session-words"}),l.createEl("span",{text:"Words",cls:"stat-label"});let a=i.createEl("div",{cls:"stat-card"});a.createEl("span",{text:"\u23F1\uFE0F",cls:"stat-icon"});let u=Math.floor(n/36e5),p=Math.floor(n%36e5/6e4),h=Math.floor(n%6e4/1e3),g=u>0?`${u}:${p.toString().padStart(2,"0")}:${h.toString().padStart(2,"0")}`:`${p}:${h.toString().padStart(2,"0")}`;a.createEl("span",{text:g,cls:"stat-value session-timer"}),a.createEl("span",{text:"Time",cls:"stat-label"}),i.createEl("div",{cls:"current-file"}).createEl("span",{text:"\u{1F4C4} "+s.filePath.split("/").pop()});let w=e.createEl("div",{cls:"writing-inspiration"});this.renderWritingInspiration(w);let W=e.createEl("div",{cls:"session-actions"}).createEl("button",{text:"\u2705 Complete Session",cls:"session-btn complete-btn"});W.onclick=()=>{this.plugin.completeSession(),this.render()}}else e.createEl("p",{text:"\u{1F4A4} No active session. Open a markdown file and click the ribbon icon to start!",cls:"no-session-message"})}renderWritingInspiration(t){let e=t.createEl("div",{cls:"prompt-card"}),s=e.createEl("div",{cls:"prompt-header"});s.createEl("span",{text:"\u2728 Writing Inspiration",cls:"prompt-title"});let n=s.createEl("button",{text:"\u{1F3B2}",cls:"prompt-refresh-btn",attr:{title:"Get new inspiration"}}),r=e.createEl("div",{cls:"prompt-text"});r.setText(this.plugin.getRandomPrompt());let o=e.createEl("div",{cls:"keyword-section"});o.createEl("span",{text:"Keywords: ",cls:"keyword-label"});let i=o.createEl("span",{cls:"keywords"});for(let a=0;a<3;a++){let u=i.createEl("span",{text:this.plugin.getRandomKeyword(),cls:"keyword-tag"});a<2&&i.createEl("span",{text:" \u2022 ",cls:"keyword-separator"})}let l=e.createEl("button",{text:"\u{1F4CB} Copy to Clipboard",cls:"copy-prompt-btn"});n.onclick=()=>{r.setText(this.plugin.getRandomPrompt()),i.empty();for(let a=0;a<3;a++){let u=i.createEl("span",{text:this.plugin.getRandomKeyword(),cls:"keyword-tag"});a<2&&i.createEl("span",{text:" \u2022 ",cls:"keyword-separator"})}},l.onclick=async()=>{let a=r.textContent||"",u=Array.from(i.querySelectorAll(".keyword-tag")).map(h=>h.textContent).join(", "),p=`${a}

Keywords: ${u}`;try{await navigator.clipboard.writeText(p),l.setText("\u2705 Copied!"),setTimeout(()=>{l.setText("\u{1F4CB} Copy to Clipboard")},2e3)}catch(h){console.error("Failed to copy to clipboard:",h);let g=document.createElement("textarea");g.value=p,document.body.appendChild(g),g.select(),document.execCommand("copy"),document.body.removeChild(g),l.setText("\u2705 Copied!"),setTimeout(()=>{l.setText("\u{1F4CB} Copy to Clipboard")},2e3)}}}renderWritingMode(t){let e=t.createEl("div",{cls:"dashboard-section"});e.createEl("h3",{text:"Writing Mode"});let n=e.createEl("div",{cls:"action-buttons"}).createEl("button",{text:"\u{1F680} Start Session",cls:"action-btn start-session-btn"});n.onclick=async()=>{await this.plugin.createTemplateNoteAndStartSession()}}renderContinuousWriting(t){if(!this.plugin.settings.continuousWriting.enabled)return;let e=t.createEl("div",{cls:"dashboard-section continuous-writing"});e.createEl("h3",{text:"Continuous Writing Mode"});let s=this.plugin.settings.continuousWriting.currentCount,n=this.plugin.settings.continuousWriting.targetSessions,r=this.plugin.settings.continuousWriting.sessionDuration,o=e.createEl("div",{cls:"continuous-progress-overview"}),i=o.createEl("div",{cls:"continuous-progress-text"});i.createEl("span",{text:`${s} / ${n}`,cls:"continuous-count"}),i.createEl("span",{text:" sessions completed",cls:"continuous-label"});let l=Math.round(s/n*100);i.createEl("span",{text:` (${l}%)`,cls:"continuous-percentage"});let u=o.createEl("div",{cls:"continuous-progress-bar"}).createEl("div",{cls:"continuous-progress-fill",attr:{style:`width: ${Math.min(l,100)}%`}});e.createEl("div",{cls:"continuous-session-info"}).createEl("p",{text:`Target: ${r} minutes per session`,cls:"session-duration-info"});let h=e.createEl("div",{cls:"continuous-actions"}),g=h.createEl("button",{text:"\u{1F680} Start Continuous Session",cls:"action-btn continuous-start-btn"});if(g.onclick=async()=>{await this.plugin.createTemplateNoteAndStartSession()},s>0){let f=h.createEl("button",{text:"\u{1F504} Reset Progress",cls:"action-btn continuous-reset-btn"});f.onclick=async()=>{this.plugin.settings.continuousWriting.currentCount=0,await this.plugin.saveSettings(),this.render()}}if(s>=n){let f=e.createEl("div",{cls:"continuous-achievement"});f.createEl("div",{text:"\u{1F389}",cls:"achievement-icon"}),f.createEl("div",{text:`Congratulations! You've completed ${n} continuous sessions!`,cls:"achievement-text"})}}renderWritingVolumeChart(t){let e=t.createEl("div",{cls:"dashboard-section"});e.createEl("h3",{text:"Writing Volume"});let s=e.createEl("div",{cls:"chart-container"});this.renderWeeklyChart(s),this.renderMonthlyChart(s),this.renderVolumeTotals(s)}renderWeeklyChart(t){let e=t.createEl("div",{cls:"weekly-chart"});e.createEl("h4",{text:"Last 7 Days"});let s=e.createEl("div",{cls:"bar-chart"}),n=this.getWeeklyData(),r=Math.max(...n.map(o=>o.words),100);n.forEach((o,i)=>{let l=s.createEl("div",{cls:"bar-container"});l.createEl("div",{cls:"bar-label"}).setText(o.label);let u=l.createEl("div",{cls:"bar"}),p=Math.max(o.words/r*100,2);u.style.height=`${p}%`,u.addClass(o.words>0?"has-data":"no-data"),u.title=`${o.words} words`,o.words>0&&l.createEl("div",{cls:"word-count"}).setText(o.words.toString())})}renderMonthlyChart(t){let e=t.createEl("div",{cls:"monthly-chart"});e.createEl("h4",{text:"Last 30 Days"});let s=e.createEl("div",{cls:"line-chart"}),n=this.getMonthlyData(),r=Math.max(...n.map(o=>o.words),100);s.innerHTML=`
			<svg class="chart-svg" width="100%" height="120" viewBox="0 0 400 120">
				${this.generateSVGPath(n,r)}
				${this.generateSVGDots(n,r)}
			</svg>
		`}renderVolumeTotals(t){let e=t.createEl("div",{cls:"volume-totals"}),s=this.getWeeklyData().reduce((i,l)=>i+l.words,0),n=this.getMonthlyData().reduce((i,l)=>i+l.words,0),r=e.createEl("div",{cls:"volume-card"});r.createEl("div",{text:s.toString(),cls:"volume-number"}),r.createEl("div",{text:"Words This Week",cls:"volume-label"});let o=e.createEl("div",{cls:"volume-card"});o.createEl("div",{text:n.toString(),cls:"volume-number"}),o.createEl("div",{text:"Words This Month",cls:"volume-label"})}generateSVGPath(t,e){let s="";return t.forEach((n,r)=>{let o=r/(t.length-1)*380+10,i=100-n.words/e*80;s+=(r===0?"M":"L")+` ${o} ${i}`}),`<path d="${s}" fill="none" stroke="var(--interactive-accent)" stroke-width="2" style="filter: drop-shadow(0 1px 3px rgba(0, 0, 0, 0.1));" />`}generateSVGDots(t,e){let s="";return t.forEach((n,r)=>{if(n.words>0){let o=r/(t.length-1)*380+10,i=100-n.words/e*80;s+=`<circle cx="${o}" cy="${i}" r="3" fill="var(--interactive-accent)" style="cursor: pointer;">
					<title>${n.date}: ${n.words} words</title>
				</circle>`}}),s}getWeeklyData(){let t=[],e=new Date;for(let s=6;s>=0;s--){let n=new Date(e);n.setDate(e.getDate()-s);let r=n.toISOString().split("T")[0],o=this.plugin.sessionHistory.filter(i=>i.date===r&&i.endTime).reduce((i,l)=>i+l.wordCount,0);t.push({date:r,label:n.toLocaleDateString("en-US",{weekday:"short"}),words:o})}return t}getMonthlyData(){let t=[],e=new Date;for(let s=29;s>=0;s--){let n=new Date(e);n.setDate(e.getDate()-s);let r=n.toISOString().split("T")[0],o=this.plugin.sessionHistory.filter(i=>i.date===r&&i.endTime).reduce((i,l)=>i+l.wordCount,0);t.push({date:r,words:o})}return t}refresh(){this.render()}};
