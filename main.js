/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var U=Object.defineProperty;var nt=Object.getOwnPropertyDescriptor;var rt=Object.getOwnPropertyNames;var at=Object.prototype.hasOwnProperty;var ot=(h,s)=>{for(var t in s)U(h,t,{get:s[t],enumerable:!0})},lt=(h,s,t,e)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of rt(s))!at.call(h,i)&&i!==t&&U(h,i,{get:()=>s[i],enumerable:!(e=nt(s,i))||e.enumerable});return h};var ct=h=>lt(U({},"__esModule",{value:!0}),h);var pt={};ot(pt,{default:()=>H});module.exports=ct(pt);var f=require("obsidian");var G=require("obsidian"),W=class{constructor(s){this.cachedPrompts=[];this.lastFetchTime=0;this.CACHE_DURATION=24*60*60*1e3;this.CACHE_FILE=".writing-momentum/network-prompts.json";this.promptSources=[{name:"Writing Prompts Reddit",url:"https://www.reddit.com/r/WritingPrompts/hot.json?limit=50",selector:"json",transform:s=>{try{let t=JSON.parse(s),e=[];if(t.data&&t.data.children){for(let i of t.data.children)if(i.data&&i.data.title){let n=i.data.title;n=n.replace(/^\[.*?\]\s*/,""),n=n.trim(),n.length>20&&n.length<200&&e.push(n)}}return e}catch(t){return console.error("Error parsing Reddit JSON:",t),[]}}}];this.plugin=s,this.loadCachedPrompts()}async loadCachedPrompts(){try{let s=this.plugin.app.vault.getAbstractFileByPath(this.CACHE_FILE);if(s instanceof G.TFile){let t=await this.plugin.app.vault.read(s),e=JSON.parse(t);e.prompts&&Array.isArray(e.prompts)&&(this.cachedPrompts=e.prompts,this.lastFetchTime=e.timestamp||0)}}catch(s){}}async saveCachedPrompts(){try{let s={prompts:this.cachedPrompts,timestamp:this.lastFetchTime},t=".writing-momentum";await this.plugin.app.vault.adapter.exists(t)||await this.plugin.app.vault.createFolder(t);let i=this.plugin.app.vault.getAbstractFileByPath(this.CACHE_FILE);i instanceof G.TFile?await this.plugin.app.vault.modify(i,JSON.stringify(s,null,2)):await this.plugin.app.vault.create(this.CACHE_FILE,JSON.stringify(s,null,2))}catch(s){console.error("Error saving cached prompts:",s)}}async fetchNetworkPrompts(){let s=Date.now();if(this.cachedPrompts.length>0&&s-this.lastFetchTime<this.CACHE_DURATION)return this.cachedPrompts;try{let t=[];for(let e of this.promptSources)try{let i=await this.fetchFromSource(e);t.push(...i)}catch(i){console.error(`Error fetching from ${e.name}:`,i)}if(t.length>0){let e=[...new Set(t)].filter(i=>i.length>10&&i.length<300).slice(0,100);this.cachedPrompts=e,this.lastFetchTime=s,await this.saveCachedPrompts()}return this.cachedPrompts}catch(t){return console.error("Error fetching network prompts:",t),this.cachedPrompts}}async fetchFromSource(s){try{let t=await fetch(s.url,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);let e=await t.text();if(s.transform){let i=s.transform(e);return Array.isArray(i)?i:[]}return this.extractPromptsFromHTML(e,s.selector)}catch(t){return console.error(`Error fetching from ${s.name}:`,t),[]}}extractPromptsFromHTML(s,t){let e=[];try{new DOMParser().parseFromString(s,"text/html").querySelectorAll(t).forEach(a=>{var o;let l=(o=a.textContent)==null?void 0:o.trim();l&&l.length>10&&l.length<300&&e.push(l)})}catch(i){console.error("Error parsing HTML:",i)}return e}getRandomNetworkPrompt(){if(this.cachedPrompts.length===0)return null;let s=Math.floor(Math.random()*this.cachedPrompts.length);return this.cachedPrompts[s]}async refreshPrompts(){return this.lastFetchTime=0,(await this.fetchNetworkPrompts()).length>0}getCachedPromptsCount(){return this.cachedPrompts.length}getLastFetchTime(){return this.lastFetchTime>0?new Date(this.lastFetchTime):null}};var j=require("obsidian"),M=class{constructor(s){this.scheduledReminders=new Map;this.snoozeQueue=new Map;this.plugin=s}start(){this.scheduleAllReminders(),this.plugin.registerInterval(window.setInterval(()=>this.checkReminders(),6e4))}stop(){this.scheduledReminders.clear(),this.snoozeQueue.clear()}scheduleAllReminders(){let s=this.plugin.settings.reminders.filter(t=>t.enabled);for(let t of s)this.scheduleReminder(t)}scheduleReminder(s){let t=new Date,e=t.getDay();if(!s.days.includes(e))return;let[i,n]=s.time.split(":").map(Number),r=new Date;if(r.setHours(i,n,0,0),r<=t&&r.setDate(r.getDate()+1),this.isInDoNotDisturbPeriod(s))return;let a=window.setTimeout(()=>{this.triggerReminder(s)},r.getTime()-t.getTime());this.scheduledReminders.set(s.id,a)}isInDoNotDisturbPeriod(s){if(!s.dnd)return!1;let t=new Date,e=t.getHours()*60+t.getMinutes(),[i,n]=s.dnd.start.split(":").map(Number),[r,a]=s.dnd.end.split(":").map(Number),l=i*60+n,o=r*60+a;return l<=o?e>=l&&e<=o:e>=l||e<=o}async triggerReminder(s){let t="Time to write! Click to start your writing session.",e=new j.Notice(t,0),i=e.noticeEl;i.addClass("clickable-notice"),i.onclick=()=>{e.hide(),this.handleReminderClick(s)};let n=i.createEl("button",{text:"Snooze 10m",cls:"snooze-btn"});n.onclick=r=>{r.stopPropagation(),this.snoozeReminder(s.id,10),e.hide()},s.secondShotMins&&setTimeout(()=>{this.hasWrittenToday()||this.triggerReminder(s)},s.secondShotMins*60*1e3)}async handleReminderClick(s){try{await this.plugin.templateEngine.createNoteFromTemplate()}catch(t){console.error("Failed to create note from reminder:",t),new j.Notice("Failed to create writing note. Please try again.")}}snoozeReminder(s,t){let e=Date.now()+t*60*1e3;this.snoozeQueue.set(s,e),setTimeout(()=>{let i=this.plugin.settings.reminders.find(n=>n.id===s);i&&this.triggerReminder(i),this.snoozeQueue.delete(s)},t*60*1e3)}checkReminders(){}hasWrittenToday(){let s=new Date().toISOString().split("T")[0];return this.plugin.dataManager.getTodaysSessions().some(e=>e.completed&&e.wordCount>0)}reschedule(){this.stop(),this.start()}};var q=require("obsidian"),I=class{constructor(s){this.prompts=[];this.plugin=s}async initialize(){await this.loadPrompts()}extractVariables(s){let t=/\{\{([^}]+)\}\}/g,e=new Set,i;for(;(i=t.exec(s))!==null;)e.add(i[1].trim());return Array.from(e)}async loadPrompts(){let s=this.plugin.settings.paths.prompts,t=this.plugin.app.vault.getAbstractFileByPath(s);if(!(t instanceof q.TFile)){await this.createDefaultPrompts();return}try{let e=await this.plugin.app.vault.read(t);this.prompts=this.parsePrompts(e)}catch(e){console.error("Failed to load prompts:",e),await this.createDefaultPrompts()}}parsePrompts(s){let t=s.split(`
`),e=[];for(let i of t){let n=i.trim();n.startsWith("- ")||n.startsWith("* ")?e.push(n.substring(2)):n&&!n.startsWith("#")&&e.push(n)}return e.filter(i=>i.length>0)}async createDefaultPrompts(){let s=this.plugin.settings.paths.prompts,t=`# Writing Prompts

- What was the most meaningful moment today?
- What did I learn today?
- Express your current feeling in one word.
- What am I grateful for right now?
- What challenge did I overcome today?
- What would I tell my past self?
- What's one thing I want to remember about today?
- How did I grow today?
- What made me smile today?
- What am I looking forward to tomorrow?
- Describe today in exactly three words.
- What surprised me today?
- What would I change about today?
- What small victory can I celebrate?
- What's one thing I did well today?`;try{await this.plugin.app.vault.create(s,t),await this.loadPrompts()}catch(e){console.error("Failed to create default prompts:",e)}}async createNoteFromTemplate(s){let t=this.buildVariables(s),e=this.processTemplate(this.plugin.settings.defaultTitlePattern,t),i=this.processTemplate(this.plugin.settings.defaultTemplate,t),n={name:"title",value:e},r=this.processTemplate(i,[n]),a=`${e}.md`;try{let l=await this.plugin.app.vault.create(a,r);return await this.plugin.app.workspace.getLeaf().openFile(l),this.plugin.sessionManager.startSession(l.path,"default"),l}catch(l){if(l.message.includes("already exists")){let o=this.plugin.app.vault.getAbstractFileByPath(a);if(o instanceof q.TFile)return await this.plugin.app.workspace.getLeaf().openFile(o),o;throw new Error("File exists but is not a valid file")}throw l}}buildVariables(s){let t=new Date,e=[{name:"date",value:this.formatDate(t)},{name:"time",value:t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})},{name:"weekday",value:t.toLocaleDateString("en-US",{weekday:"long"})},{name:"vault",value:this.plugin.app.vault.getName()},{name:"random_prompt",value:()=>this.getRandomPrompt()}];if(s)for(let[i,n]of Object.entries(s))e.push({name:i,value:n});return e}processTemplate(s,t){let e=s;for(let i of t){let n=typeof i.value=="function"?i.value():i.value,r=new RegExp(`\\{\\{\\s*${i.name}\\s*\\}\\}`,"g");e=e.replace(r,n)}return e}formatDate(s){let t=this.plugin.settings.dateFormat,e=s.getFullYear(),i=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0");return t.replace("YYYY",e.toString()).replace("MM",i).replace("DD",n)}getRandomPrompt(){var t;if((t=this.plugin.settings.randomPrompts)!=null&&t.enabled&&this.plugin.randomPrompts){let e=this.plugin.randomPrompts.getRandomNetworkPrompt();if(e){if(this.plugin.settings.randomPrompts.mixWithLocal){let i=[...this.prompts];if(i.length>0){if(Math.random()<.5)return e;{let n=Math.floor(Math.random()*i.length);return i[n]}}}return e}}if(this.prompts.length===0)return"What's on your mind today?";let s=Math.floor(Math.random()*this.prompts.length);return this.prompts[s]}getDefaultTemplate(){return{title:this.plugin.settings.defaultTitlePattern,content:this.plugin.settings.defaultTemplate}}async reloadPrompts(){await this.loadPrompts()}};var A=class{constructor(s){this.sessions=[];this.streak={current:0,longest:0,lastWritingDay:"",graceUsed:0,weeklyProgress:[]};this.plugin=s}async loadData(){let s=await this.plugin.loadData();if(s&&typeof s=="object"&&"writingData"in s){let t=s.writingData;this.sessions=t.sessions||[],this.streak=t.streak||this.getDefaultStreak()}}async saveData(){let s=await this.plugin.loadData()||{};s.writingData={sessions:this.sessions,streak:this.streak,lastUpdated:new Date().toISOString()},await this.plugin.saveData(s)}getDefaultStreak(){return{current:0,longest:0,lastWritingDay:"",graceUsed:0,weeklyProgress:new Array(7).fill(0)}}async addSession(s){this.sessions.push(s),s.completed&&s.wordCount>0&&this.updateStreak(s.date),await this.saveData()}async updateSession(s,t){let e=this.sessions.findIndex(i=>i.id===s);e!==-1&&(this.sessions[e]={...this.sessions[e],...t},t.completed&&this.sessions[e].wordCount>0&&this.updateStreak(this.sessions[e].date),await this.saveData())}getTodaysSessions(){let s=new Date().toISOString().split("T")[0];return this.sessions.filter(t=>t.date===s)}getSessionsForDate(s){return this.sessions.filter(t=>t.date===s)}getSessionsForWeek(s){let t=new Date(s),e=new Date(t);return e.setDate(e.getDate()+7),this.sessions.filter(i=>{let n=new Date(i.date);return n>=t&&n<e})}getSessionsForMonth(s,t){return this.sessions.filter(e=>{let i=new Date(e.date);return i.getFullYear()===s&&i.getMonth()===t})}getTodaysWordCount(){return this.getTodaysSessions().filter(s=>s.completed).reduce((s,t)=>s+t.wordCount,0)}getWeekWordCount(){let s=new Date,t=new Date(s);return t.setDate(s.getDate()-s.getDay()),t.setHours(0,0,0,0),this.sessions.filter(e=>new Date(e.date)>=t&&e.completed).reduce((e,i)=>e+i.wordCount,0)}getMonthWordCount(){let s=new Date,t=new Date(s.getFullYear(),s.getMonth(),1);return this.sessions.filter(e=>new Date(e.date)>=t&&e.completed).reduce((e,i)=>e+i.wordCount,0)}updateStreak(s){let t=this.plugin.settings.streakRule,e=new Date().toISOString().split("T")[0],i=new Date(Date.now()-24*60*60*1e3).toISOString().split("T")[0];t.mode==="daily"?this.updateDailyStreak(s,e,i):this.updateWeeklyStreak()}updateDailyStreak(s,t,e){this.streak.lastWritingDay!==s&&(this.streak.lastWritingDay===e||this.streak.lastWritingDay===""?this.streak.current++:this.canUseGraceDay()?(this.streak.graceUsed++,this.streak.current++):(this.streak.current=1,this.streak.graceUsed=0),this.streak.lastWritingDay=s,this.streak.current>this.streak.longest&&(this.streak.longest=this.streak.current))}updateWeeklyStreak(){let s=new Date,t=new Date(s);t.setDate(s.getDate()-s.getDay());let e=this.getSessionsForWeek(t.toISOString().split("T")[0]),i=new Set(e.filter(l=>l.completed&&l.wordCount>0).map(l=>l.date)).size,n=this.plugin.settings.streakRule.target,r=t.toISOString().split("T")[0],a=this.streak.lastWritingDay;if(i>=n)a!==r&&(this.streak.current++,this.streak.lastWritingDay=r,this.streak.current>this.streak.longest&&(this.streak.longest=this.streak.current));else{let l=new Date().toISOString().split("T")[0],o=new Date(t);o.setDate(o.getDate()+6),l>o.toISOString().split("T")[0]&&a!==r&&(this.streak.current=0,this.streak.graceUsed=0,this.streak.lastWritingDay=r)}this.streak.weeklyProgress=new Array(7).fill(0);for(let l=0;l<7;l++){let o=new Date(t);o.setDate(t.getDate()+l);let c=o.toISOString().split("T")[0],u=e.some(m=>m.date===c&&m.completed&&m.wordCount>0);this.streak.weeklyProgress[l]=u?1:0}}canUseGraceDay(){let s=this.plugin.settings.streakRule.grace;return this.streak.graceUsed<s}getStreak(){return this.streak}getDashboardStats(){let s=this.sessions.filter(r=>r.completed).sort((r,a)=>new Date(a.date).getTime()-new Date(r.date).getTime()).slice(0,7),t=this.sessions.filter(r=>r.completed).length,e=this.sessions.filter(r=>r.completed&&r.targetCount&&r.wordCount>=r.targetCount).length,i=t>0?e/t*100:0,n=this.getSessionsForWeek(new Date(Date.now()-7*24*60*60*1e3).toISOString().split("T")[0]).filter(r=>r.completed).length;return{todayWordCount:this.getTodaysWordCount(),weekWordCount:this.getWeekWordCount(),monthWordCount:this.getMonthWordCount(),streak:this.streak,sessionsThisWeek:n,completionRate:i,recentSessions:s}}async deleteSession(s){this.sessions=this.sessions.filter(t=>t.id!==s),await this.saveData()}async clearAllData(){this.sessions=[],this.streak=this.getDefaultStreak(),await this.saveData()}exportData(){return{sessions:this.sessions,streak:this.streak,exportDate:new Date().toISOString(),version:"1.0"}}async importData(s){s.sessions&&(this.sessions=[...this.sessions,...s.sessions]),s.streak&&s.streak.longest>this.streak.longest&&(this.streak.longest=s.streak.longest),await this.saveData()}};var y=require("obsidian"),L=class{constructor(s){this.currentSession=null;this.wordCountInterval=null;this.sessionStartContent=new Map;this.plugin=s}startSession(s,t,e){this.currentSession&&this.endSession();let i=`session-${Date.now()}`,n=new Date().toISOString().split("T")[0];this.currentSession={id:i,date:n,startTime:Date.now(),wordCount:0,templateUsed:t,files:[s],completed:!1,targetCount:e},this.captureInitialContent(s),this.startWordCountMonitoring(),this.plugin.settings.ui.notifications&&new y.Notice(`Writing session started! Target: ${e||"No limit"} words`),this.updateStatusBar()}async captureInitialContent(s){try{let t=this.plugin.app.vault.getAbstractFileByPath(s);if(t instanceof y.TFile){let e=await this.plugin.app.vault.read(t);this.sessionStartContent.set(s,e)}}catch(t){console.error("Failed to capture initial content:",t),this.sessionStartContent.set(s,"")}}startWordCountMonitoring(){this.wordCountInterval&&window.clearInterval(this.wordCountInterval),this.wordCountInterval=window.setInterval(()=>{this.updateSessionWordCount()},5e3),this.plugin.registerInterval(this.wordCountInterval)}async updateSessionWordCount(){if(!this.currentSession)return;let s=0;for(let t of this.currentSession.files){let e=this.plugin.app.vault.getAbstractFileByPath(t);if(e instanceof y.TFile)try{let i=await this.plugin.app.vault.read(e),n=this.sessionStartContent.get(t)||"",r=this.calculateNewWords(n,i);s+=r}catch(i){console.error(`Failed to read file ${t}:`,i)}}this.currentSession.wordCount=Math.max(0,s),this.updateStatusBar(),this.currentSession.targetCount&&this.currentSession.wordCount>=this.currentSession.targetCount&&!this.currentSession.completed&&this.completeSession()}calculateNewWords(s,t){let e=this.countWords(s),i=this.countWords(t);return Math.max(0,i-e)}countWords(s){return s.replace(/^---[\s\S]*?---\n?/,"").trim().split(/\s+/).filter(e=>e.length>0).length}completeSession(){if(this.currentSession){if(this.currentSession.completed=!0,this.currentSession.endTime=Date.now(),this.plugin.dataManager.addSession(this.currentSession),this.plugin.settings.continuousWriting.enabled){let s=Math.round((Date.now()-this.currentSession.startTime)/6e4),t=this.plugin.settings.continuousWriting.sessionDuration;s>=t&&(this.plugin.settings.continuousWriting.currentCount++,this.plugin.saveSettings(),this.plugin.settings.continuousWriting.currentCount>=this.plugin.settings.continuousWriting.targetSessions&&this.plugin.settings.ui.notifications&&new y.Notice(`\u{1F389} Amazing! You've completed ${this.plugin.settings.continuousWriting.targetSessions} continuous sessions!`,1e4))}if(this.plugin.settings.ui.notifications){let s=Math.round((Date.now()-this.currentSession.startTime)/6e4),t=`Great job! You wrote ${this.currentSession.wordCount} words in ${s} minutes.`;if(this.plugin.settings.continuousWriting.enabled){let e=this.plugin.settings.continuousWriting.currentCount,i=this.plugin.settings.continuousWriting.sessionDuration;s>=i?t+=` Continuous session ${e} completed! \u{1F525}`:t+=` (Need ${i}+ minutes for continuous progress)`}new y.Notice(t,5e3)}this.endSession()}}endSession(){this.currentSession&&!this.currentSession.completed&&(this.currentSession.endTime=Date.now(),this.plugin.dataManager.addSession(this.currentSession)),this.currentSession=null,this.sessionStartContent.clear(),this.wordCountInterval&&(window.clearInterval(this.wordCountInterval),this.wordCountInterval=null),this.updateStatusBar()}pauseSession(){this.currentSession&&(this.wordCountInterval&&(window.clearInterval(this.wordCountInterval),this.wordCountInterval=null),new y.Notice("Writing session paused"))}resumeSession(){this.currentSession&&!this.wordCountInterval&&(this.startWordCountMonitoring(),new y.Notice("Writing session resumed"))}getCurrentSession(){return this.currentSession}async addFileToCurrentSession(s){this.currentSession&&!this.currentSession.files.includes(s)&&(this.currentSession.files.push(s),await this.captureInitialContent(s))}setSessionTarget(s){this.currentSession&&(this.currentSession.targetCount=s,this.updateStatusBar())}updateStatusBar(){if(this.plugin.statusBarItem)if(this.currentSession){let s=this.currentSession.targetCount?` (${Math.min(100,Math.round(this.currentSession.wordCount/this.currentSession.targetCount*100))}%)`:"";this.plugin.statusBarItem.setText(`\u270D\uFE0F ${this.currentSession.wordCount}${this.currentSession.targetCount?`/${this.currentSession.targetCount}`:""} words${s}`)}else{let s=this.plugin.dataManager.getTodaysWordCount();this.plugin.statusBarItem.setText(`\u{1F4CA} ${s} words today`)}}getSessionStats(){if(!this.currentSession)return null;let s=Date.now()-this.currentSession.startTime,t=Math.round(s/6e4),e=t>0?Math.round(this.currentSession.wordCount/t):0;return{duration:t,wordCount:this.currentSession.wordCount,wpm:e,targetProgress:this.currentSession.targetCount?this.currentSession.wordCount/this.currentSession.targetCount*100:null}}async handleFileOpen(s){this.shouldAutoStartSession(s)?this.startSession(s.path):this.currentSession&&!this.currentSession.files.includes(s.path)&&await this.addFileToCurrentSession(s.path)}shouldAutoStartSession(s){return this.currentSession||!["md","txt"].includes(s.extension)?!1:["Journal","Blog","Writing","Draft"].some(i=>s.path.toLowerCase().includes(i.toLowerCase()))}cleanup(){this.endSession(),this.wordCountInterval&&(window.clearInterval(this.wordCountInterval),this.wordCountInterval=null)}};var b=require("obsidian");var Q=[{id:"daily-journal",name:"Daily Journal",titlePattern:"{{date}} - Daily Journal",content:`# Daily Journal - {{date}}

## Morning Reflection
{{random_prompt}}

## Today's Events
- 
- 
- 

## Thoughts & Feelings


## Gratitude
1. 
2. 
3. 

---
*Written on {{weekday}} at {{time}}*`,category:"daily",description:"Structured daily journaling template",isBuiltIn:!0,createdAt:Date.now(),updatedAt:Date.now()},{id:"quick-note",name:"Quick Note",titlePattern:"{{date}} {{time}} - Quick Note",content:`# Quick Note

## Idea
{{random_prompt}}

## Details


## Next Steps
- [ ] 
- [ ] 

---
*{{weekday}} {{time}}*`,category:"custom",description:"Fast capture for ideas and thoughts",isBuiltIn:!0,createdAt:Date.now(),updatedAt:Date.now()},{id:"project-planning",name:"Project Planning",titlePattern:"{{date}} - Project {{title}}",content:`# Project: {{title}}

## Goal
{{random_prompt}}

## Overview
**Start Date:** {{date}}
**Status:** Planning

## Tasks
- [ ] Task 1
- [ ] Task 2
- [ ] Task 3

## Timeline


## Resources


---
*Created {{weekday}}, {{date}} at {{time}}*`,category:"custom",description:"Template for project planning and tracking",isBuiltIn:!0,createdAt:Date.now(),updatedAt:Date.now()},{id:"simple-writing",name:"Simple Writing",titlePattern:"{{date}} - Writing Session",content:`# {{title}}

## Prompt
{{random_prompt}}

## Writing


---
*Written on {{weekday}} at {{time}}*`,category:"custom",description:"Minimal template for freeform writing",isBuiltIn:!0,createdAt:Date.now(),updatedAt:Date.now()}],Z={reminders:[{id:"evening-default",days:[1,2,3,4,5,6,0],time:"21:00",secondShotMins:30,templateId:"daily-3lines",dnd:{start:"23:30",end:"07:30"},enabled:!0}],streakRule:{mode:"weekly",target:5,grace:1},locale:"en",dateFormat:"YYYY-MM-DD",defaultTitlePattern:"{{date}} - Writing Session",defaultTemplate:`# {{title}}

## Prompt
{{random_prompt}}

## Writing


---
*Written on {{weekday}} at {{time}}*`,templates:[...Q],activeTemplateId:"simple-writing",continuousWriting:{enabled:!1,targetSessions:30,currentCount:0,sessionDuration:25},randomPrompts:{enabled:!1,mixWithLocal:!0,autoRefresh:!0},paths:{prompts:".writing-momentum/prompts.md"},ui:{showStatusBar:!0,showRibbonIcon:!0,notifications:!0},reminderTime:"21:00",showStatusBar:!0,showRibbonIcon:!0,enableNotifications:!0};var R=class{constructor(s){this.plugin=s}getAllTemplates(){return this.plugin.settings.templates||[]}getTemplate(s){return this.plugin.settings.templates.find(t=>t.id===s)||null}getActiveTemplate(){let s=this.plugin.settings.activeTemplateId;return s?this.getTemplate(s):this.getAllTemplates()[0]||null}async setActiveTemplate(s){let t=this.getTemplate(s);if(!t){new b.Notice("Template not found");return}this.plugin.settings.activeTemplateId=s,this.plugin.settings.defaultTitlePattern=t.titlePattern,this.plugin.settings.defaultTemplate=t.content,await this.plugin.saveSettings(),new b.Notice(`Template "${t.name}" activated`)}async createTemplate(s,t,e,i){if(!s||s.trim().length===0)throw new Error("Template name cannot be empty");if(!t||t.trim().length===0)throw new Error("Title pattern cannot be empty");if(!e||e.trim().length===0)throw new Error("Template content cannot be empty");if(this.plugin.settings.templates.find(l=>l.name.toLowerCase()===s.toLowerCase()))throw new Error(`Template with name "${s}" already exists`);let a={id:`custom-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:s.trim(),titlePattern:t.trim(),content:e.trim(),variables:this.extractVariables(e),category:(i==null?void 0:i.category)||"custom",description:i==null?void 0:i.description,isBuiltIn:!1,createdAt:Date.now(),updatedAt:Date.now()};return this.plugin.settings.templates.push(a),await this.plugin.saveSettings(),new b.Notice(`Template "${s}" created successfully`),a}async updateTemplate(s,t){let e=this.plugin.settings.templates.findIndex(r=>r.id===s);if(e===-1)throw new Error("Template not found");let i=this.plugin.settings.templates[e];if(i.isBuiltIn)throw new Error("Cannot modify built-in templates. Create a copy instead.");if(t.name&&t.name!==i.name&&this.plugin.settings.templates.find(a=>a.id!==s&&a.name.toLowerCase()===t.name.toLowerCase()))throw new Error(`Template with name "${t.name}" already exists`);let n={...i,...t.name&&{name:t.name.trim()},...t.titlePattern&&{titlePattern:t.titlePattern.trim()},...t.content&&{content:t.content.trim()},...t.category&&{category:t.category},...t.description!==void 0&&{description:t.description},updatedAt:Date.now()};return t.content&&(n.variables=this.extractVariables(t.content)),this.plugin.settings.templates[e]=n,this.plugin.settings.activeTemplateId===s&&(this.plugin.settings.defaultTitlePattern=n.titlePattern,this.plugin.settings.defaultTemplate=n.content),await this.plugin.saveSettings(),new b.Notice(`Template "${n.name}" updated`),n}async renameTemplate(s,t){if(!t||t.trim().length===0)throw new Error("Template name cannot be empty");await this.updateTemplate(s,{name:t})}async deleteTemplate(s){let t=this.plugin.settings.templates.findIndex(i=>i.id===s);if(t===-1)throw new Error("Template not found");let e=this.plugin.settings.templates[t];if(e.isBuiltIn)throw new Error("Cannot delete built-in templates");if(this.plugin.settings.activeTemplateId===s){let i=this.plugin.settings.templates.filter(n=>n.id!==s);i.length>0?await this.setActiveTemplate(i[0].id):this.plugin.settings.activeTemplateId=void 0}this.plugin.settings.templates.splice(t,1),await this.plugin.saveSettings(),new b.Notice(`Template "${e.name}" deleted`)}async duplicateTemplate(s,t){let e=this.getTemplate(s);if(!e)throw new Error("Template not found");let i=t||`${e.name} (Copy)`,n=i,r=1;for(;this.plugin.settings.templates.some(a=>a.name===n);)n=`${i} ${r}`,r++;return await this.createTemplate(n,e.titlePattern,e.content,{category:e.category,description:e.description})}async resetToDefaults(){let s=this.plugin.settings.templates.filter(t=>!t.isBuiltIn);this.plugin.settings.templates=[...Q,...s],await this.plugin.saveSettings(),new b.Notice("Built-in templates restored to defaults")}extractVariables(s){let t=/\{\{([^}]+)\}\}/g,e=new Set,i;for(;(i=t.exec(s))!==null;)e.add(i[1].trim());return Array.from(e)}getUserTemplates(){return this.plugin.settings.templates.filter(s=>!s.isBuiltIn)}getBuiltInTemplates(){return this.plugin.settings.templates.filter(s=>s.isBuiltIn)}validateTemplate(s,t){let e=[];(!s||s.trim().length===0)&&e.push("Title pattern cannot be empty"),(!t||t.trim().length===0)&&e.push("Template content cannot be empty");let i=(t.match(/\{\{/g)||[]).length,n=(t.match(/\}\}/g)||[]).length;return i!==n&&e.push("Unbalanced template variables ({{ }})"),{valid:e.length===0,errors:e}}exportTemplates(){let s=this.getUserTemplates();return JSON.stringify(s,null,2)}async importTemplates(s){try{let t=JSON.parse(s);if(!Array.isArray(t))throw new Error("Invalid template data format");let e=0;for(let i of t){if(!i.name||!i.titlePattern||!i.content){console.warn("Skipping invalid template:",i);continue}let n=i.name,r=1;for(;this.plugin.settings.templates.some(a=>a.name===n);)n=`${i.name} (${r})`,r++;await this.createTemplate(n,i.titlePattern,i.content,{category:i.category,description:i.description}),e++}return new b.Notice(`Imported ${e} template(s)`),e}catch(t){throw new Error(`Failed to import templates: ${t.message}`)}}};var k=require("obsidian");var _="1.0.0",N={express:{sessionLengthMin:18,targetWords:400,sessionsPerWeek:3},monetize:{sessionLengthMin:38,targetWords:1e3,sessionsPerWeek:4},fun:{sessionLengthMin:20,targetWords:350,sessionsPerWeek:2.5},skill:{sessionLengthMin:25,targetWords:750,sessionsPerWeek:5},custom:{sessionLengthMin:20,targetWords:500,sessionsPerWeek:3}},ut={publish:2,book:2,career:2,professional:2,serious:2,improve:1,better:1,practice:1,learn:1,explore:0,try:0,fun:0,casual:0,relax:0},w=class{static estimate(s){let e={...N[s.purpose]||N.custom},i=this.getAmbitionLevel(s.outcome||"");return e.sessionsPerWeek+=i,e.targetWords=Math.round(e.targetWords*(1+.2*i)),e.sessionLengthMin=Math.round(e.sessionLengthMin*(1+.2*i)),s.feasibility==="busy"?e.sessionsPerWeek=Math.max(2,e.sessionsPerWeek-1):s.feasibility==="free"&&(e.sessionsPerWeek+=1),s.targetHint&&s.targetHint>0&&(s.unitPref==="words"?e.targetWords=s.targetHint:e.sessionLengthMin=s.targetHint),{sessionLengthMin:this.clamp(e.sessionLengthMin,10,90),target:s.unitPref==="words"?{type:"words",value:this.clamp(e.targetWords,100,3e3)}:{type:"minutes",value:this.clamp(e.sessionLengthMin,10,90)},sessionsPerWeek:this.clamp(Math.round(e.sessionsPerWeek),1,7),ruleVersion:_,calculatedAt:Date.now()}}static getAmbitionLevel(s){let t=s.toLowerCase(),e=0;for(let[i,n]of Object.entries(ut))t.includes(i)&&(e=Math.max(e,n));return e}static clamp(s,t,e){return Math.min(Math.max(s,t),e)}static getPresetForPurpose(s,t="words"){let e=N[s]||N.custom;return{sessionLengthMin:e.sessionLengthMin,target:t==="words"?{type:"words",value:e.targetWords}:{type:"minutes",value:e.sessionLengthMin},sessionsPerWeek:Math.round(e.sessionsPerWeek),ruleVersion:_,calculatedAt:Date.now()}}static timeToWords(s){return Math.round(s*40)}static wordsToTime(s){return Math.round(s/40)}static needsRecalculation(s){return s.ruleVersion!==_}static describe(s){let t=s.target.type==="words"?`${s.target.value} words`:`${s.target.value} minutes`,e=s.sessionsPerWeek===7?"daily":`${s.sessionsPerWeek}\xD7 per week`;return`${t}, ${e}`}static describePurpose(s){let t={express:"Self-Expression: 15\u201320 min or 300\u2013500 words, 3\xD7 per week",monetize:"Monetization: 30\u201345 min or 800\u20131200 words, 4\xD7 per week",fun:"Fun: 15\u201325 min, 2\u20133\xD7 per week",skill:"Skill Development: 25 min or 600\u2013900 words, 5\xD7 per week",custom:"Custom: Define your own goals"};return t[s]||t.custom}};var T=class extends k.Modal{constructor(t,e){super(t);this.step=1;this.totalSteps=5;this.answers={};this.nextButton=null;this.onComplete=e}onOpen(){this.renderStep()}onClose(){let{contentEl:t}=this;t.empty()}renderStep(){let{contentEl:t}=this;t.empty(),t.addClass("wm-onboarding-wizard");let e=t.createDiv("wm-wizard-header");e.createEl("h2",{text:"Writing Goals Setup"}),e.createEl("p",{text:`Help us understand your writing needs (Step ${this.step} of ${this.totalSteps})`});let n=t.createDiv("wm-wizard-progress").createDiv("wm-wizard-progress-bar");n.style.width=`${this.step/this.totalSteps*100}%`;let r=t.createDiv("wm-wizard-content");switch(this.step){case 1:this.renderPurposeStep(r);break;case 2:this.renderOutcomeStep(r);break;case 3:this.renderFinalGoalStep(r);break;case 4:this.renderUnitStep(r);break;case 5:this.renderRoutineStep(r);break}this.renderNavigation(t)}renderPurposeStep(t){t.createEl("h3",{text:"Why do you want to write?"}),t.createEl("p",{text:"This helps us suggest the right amount of time and effort.",cls:"wm-wizard-description"});let e=[{value:"express",label:"\u{1F4DD} Self-Expression",description:"Explore thoughts, journal, personal reflection"},{value:"monetize",label:"\u{1F4B0} Monetization",description:"Professional writing, publication, income"},{value:"fun",label:"\u{1F389} Fun & Creativity",description:"Enjoyment, creative exploration, hobby"},{value:"skill",label:"\u{1F4DA} Skill Development",description:"Practice, improve writing craft, learn"},{value:"custom",label:"\u270F\uFE0F Other",description:"Something else (please describe)"}],i=t.createDiv("wm-wizard-options");if(e.forEach(n=>{let r=i.createDiv("wm-wizard-option");this.answers.purpose===n.value&&r.addClass("selected");let a=r.createDiv("wm-wizard-option-title");a.textContent=n.label;let l=r.createDiv("wm-wizard-option-desc");l.textContent=n.description,r.addEventListener("click",()=>{this.answers.purpose=n.value,this.renderStep()})}),this.answers.purpose==="custom"){let n=t.createDiv("wm-wizard-custom");new k.Setting(n).setName("Describe your purpose").addText(r=>r.setPlaceholder("e.g., Academic research, Technical documentation...").setValue(this.answers.customPurpose||"").onChange(a=>{this.answers.customPurpose=a,this.updateNavigationState()}))}}renderOutcomeStep(t){let e=this.getOutcomeData();if(t.createEl("h3",{text:e.question}),t.createEl("p",{text:"This helps us understand what you want from your writing.",cls:"wm-wizard-description"}),this.answers.purpose==="custom"){let n=t.createDiv("wm-wizard-input-large").createEl("textarea",{cls:"wm-wizard-textarea",attr:{placeholder:"Describe your goal in one line..."}});n.value=this.answers.outcome||"",n.addEventListener("input",()=>{this.answers.outcome=n.value,this.updateNavigationState()})}else{let i=t.createDiv("wm-wizard-options");e.choices.forEach(n=>{let r=i.createDiv("wm-wizard-option");this.answers.outcome===n&&r.addClass("selected");let a=r.createDiv("wm-wizard-option-title");a.textContent=n,r.addEventListener("click",()=>{this.answers.outcome=n,this.renderStep()})})}}renderFinalGoalStep(t){t.createEl("h3",{text:"What is your final writing goal?"}),t.createEl("p",{text:"Tell us the total amount you want to complete. This helps us recommend realistic daily targets.",cls:"wm-wizard-description"});let e=t.createDiv("wm-wizard-examples");e.createEl("p",{text:"Examples:",cls:"wm-wizard-examples-label"});let i=e.createEl("ul",{cls:"wm-wizard-examples-list"});["Write a 50,000 word novel","Complete 20 hours of writing practice","Publish 30 blog posts","Write 100 pages of content"].forEach(l=>{i.createEl("li",{text:l})});let a=t.createDiv("wm-wizard-input-large").createEl("textarea",{cls:"wm-wizard-textarea",attr:{placeholder:'Describe your total goal (e.g., "Write a 50,000 word novel")...'}});a.value=this.answers.finalGoal||"",a.addEventListener("input",()=>{this.answers.finalGoal=a.value,this.updateNavigationState()})}renderUnitStep(t){t.createEl("h3",{text:"How would you like to track progress?"}),t.createEl("p",{text:"Choose what feels most motivating to you.",cls:"wm-wizard-description"});let e=[{value:"words",label:"\u{1F4CA} Word Count",description:"Track by number of words written (e.g., 500 words per session)"},{value:"minutes",label:"\u23F1\uFE0F Time",description:"Track by time spent writing (e.g., 25 minutes per session)"}],i=t.createDiv("wm-wizard-unit-options");e.forEach(n=>{let r=i.createDiv("wm-wizard-unit-option");this.answers.unitPref===n.value&&r.addClass("selected");let a=r.createDiv("wm-wizard-unit-icon");a.textContent=n.label.split(" ")[0];let l=r.createDiv("wm-wizard-unit-content");l.createEl("div",{text:n.label,cls:"wm-wizard-unit-label"}),l.createEl("div",{text:n.description,cls:"wm-wizard-unit-desc"}),r.addEventListener("click",()=>{this.answers.unitPref=n.value,this.renderStep()})})}renderRoutineStep(t){t.createEl("h3",{text:"About your schedule"}),t.createEl("p",{text:"Help us suggest a realistic writing frequency.",cls:"wm-wizard-description"});let e=t.createDiv("wm-wizard-section");e.createEl("h4",{text:"How is your schedule?"});let i=[{value:"busy",label:"Busy",description:"Limited free time"},{value:"normal",label:"Normal",description:"Moderate availability"},{value:"free",label:"Flexible",description:"Good availability"}],n=e.createDiv("wm-wizard-feasibility-grid");i.forEach(c=>{let u=n.createEl("button",{text:c.label,cls:"wm-wizard-feasibility-btn"});u.createDiv({text:c.description,cls:"wm-wizard-feasibility-desc"}),this.answers.feasibility===c.value&&u.addClass("selected"),u.addEventListener("click",()=>{this.answers.feasibility=c.value,this.renderStep()})});let r=t.createDiv("wm-wizard-section");r.createEl("h4",{text:"Preferred days (optional)"}),r.createEl("p",{text:"Select days when you typically have time to write.",cls:"wm-wizard-description"});let a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],l=r.createDiv("wm-wizard-days-grid");this.answers.preferredDays||(this.answers.preferredDays=[]),a.forEach((c,u)=>{var d;let m=l.createEl("button",{text:c,cls:"wm-wizard-day-btn"});(d=this.answers.preferredDays)!=null&&d.includes(u)&&m.addClass("selected"),m.addEventListener("click",()=>{this.answers.preferredDays||(this.answers.preferredDays=[]);let g=this.answers.preferredDays.indexOf(u);g>-1?this.answers.preferredDays.splice(g,1):this.answers.preferredDays.push(u),this.renderStep()})});let o=t.createDiv("wm-wizard-section");new k.Setting(o).setName("Preferred time (optional)").setDesc("When do you typically like to write?").addText(c=>c.setPlaceholder("20:30").setValue(this.answers.preferredTime||"").onChange(u=>{this.answers.preferredTime=u}))}renderNavigation(t){let e=t.createDiv("wm-wizard-nav");this.step>1&&e.createEl("button",{text:"Back",cls:"wm-wizard-btn wm-wizard-btn-back"}).addEventListener("click",()=>{this.step--,this.renderStep()});let i=e.createEl("button",{text:this.step===this.totalSteps?"Calculate & Finish":"Next",cls:"wm-wizard-btn wm-wizard-btn-next"});this.nextButton=i,i.disabled=!this.canProceed(),i.addEventListener("click",()=>{this.step===this.totalSteps?this.complete():(this.step++,this.renderStep())})}updateNavigationState(){this.nextButton&&(this.nextButton.disabled=!this.canProceed())}canProceed(){switch(this.step){case 1:return!!this.answers.purpose&&(this.answers.purpose!=="custom"||!!this.answers.customPurpose);case 2:return!!this.answers.outcome&&this.answers.outcome.trim().length>0;case 3:return!!this.answers.finalGoal&&this.answers.finalGoal.trim().length>0;case 4:return!!this.answers.unitPref;case 5:return!!this.answers.feasibility;default:return!1}}getOutcomeData(){let t={express:{question:"What do you hope your writing gives you?",choices:["Clearer thoughts","Emotional release","Daily reflection","Document your growth"]},monetize:{question:"What result do you want from writing?",choices:["Build audience","Earn income","Publish consistently","Build portfolio"]},fun:{question:"What kind of writing feels most fun to you?",choices:["Stories","Free writing","Poems","Random prompts"]},skill:{question:"Which skill do you want to strengthen?",choices:["Structure","Clarity","Style variety","Speed"]},custom:{question:"Describe your goal in one line.",choices:[]}};return t[this.answers.purpose||"custom"]||t.custom}complete(){let t={purpose:this.answers.purpose,customPurpose:this.answers.customPurpose,outcome:this.answers.outcome,finalGoal:this.answers.finalGoal,unitPref:this.answers.unitPref,targetHint:this.answers.targetHint,feasibility:this.answers.feasibility,preferredDays:this.answers.preferredDays,preferredTime:this.answers.preferredTime},e=w.estimate(t),i={id:`profile-${Date.now()}`,answers:t,recommendation:e,notifyLevel:"mid",breakMin:5,createdAt:Date.now(),updatedAt:Date.now()};this.onComplete(i),this.close()}};var tt=require("obsidian");var B=class extends tt.Modal{constructor(t,e,i,n){super(t);this.profile=e,this.onEdit=i,this.onRecalculate=n}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("wm-qa-review-modal");let e=t.createDiv("wm-modal-header");e.createEl("h2",{text:"Your Writing Profile"}),e.createEl("p",{text:"Review your Q&A answers and recommendations",cls:"wm-modal-subtitle"});let i=t.createDiv("wm-modal-section");i.createEl("h3",{text:"\u{1F4CB} Your Answers"});let n=i.createDiv("wm-answers-grid");if(this.addAnswerRow(n,"Purpose",this.getPurposeLabel(this.profile.answers.purpose)),this.profile.answers.customPurpose&&this.addAnswerRow(n,"Custom Purpose",this.profile.answers.customPurpose),this.addAnswerRow(n,"Goal",this.profile.answers.outcome||"Not specified"),this.addAnswerRow(n,"Tracking Method",this.profile.answers.unitPref==="words"?"\u{1F4CA} Word Count":"\u23F1\uFE0F Time"),this.profile.answers.targetHint){let v=this.profile.answers.unitPref==="words"?`${this.profile.answers.targetHint} words`:`${this.profile.answers.targetHint} minutes`;this.addAnswerRow(n,"Target Hint",v)}if(this.profile.answers.feasibility){let v=this.profile.answers.feasibility.charAt(0).toUpperCase()+this.profile.answers.feasibility.slice(1);this.addAnswerRow(n,"Schedule",v)}if(this.profile.answers.preferredDays&&this.profile.answers.preferredDays.length>0){let v=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],V=this.profile.answers.preferredDays.map(X=>v[X]).join(", ");this.addAnswerRow(n,"Preferred Days",V)}this.profile.answers.preferredTime&&this.addAnswerRow(n,"Preferred Time",this.profile.answers.preferredTime);let r=t.createDiv("wm-modal-section wm-recommendation-section");r.createEl("h3",{text:"\u{1F3AF} Recommended Defaults"});let a=r.createDiv("wm-recommendation-grid");this.addRecCard(a,"Session Length",`${this.profile.recommendation.sessionLengthMin} minutes`,"\u23F1\uFE0F");let l=this.profile.recommendation.target.type==="words"?`${this.profile.recommendation.target.value} words`:`${this.profile.recommendation.target.value} minutes`;this.addRecCard(a,"Per-Session Target",l,"\u{1F3AF}");let o=this.profile.recommendation.sessionsPerWeek===7?"Daily":`${this.profile.recommendation.sessionsPerWeek}\xD7 per week`;this.addRecCard(a,"Frequency",o,"\u{1F4C5}"),this.profile.overrides&&r.createDiv("wm-override-notice").createEl("p",{text:'\u26A0\uFE0F You have manual overrides active. Use "Recalculate" to apply new recommendations.',cls:"wm-override-text"});let c=r.createDiv("wm-calc-info"),u=new Date(this.profile.recommendation.calculatedAt);c.createEl("p",{text:`Calculated: ${u.toLocaleDateString()} at ${u.toLocaleTimeString()}`,cls:"wm-calc-date"}),c.createEl("p",{text:`Rule version: ${this.profile.recommendation.ruleVersion}`,cls:"wm-rule-version"}),w.needsRecalculation(this.profile.recommendation)&&t.createDiv("wm-update-notice").createEl("p",{text:'\u{1F504} New calculation rules available. Click "Recalculate" to update.',cls:"wm-update-text"});let m=t.createDiv("wm-modal-actions");m.createEl("button",{text:"Edit Answers",cls:"wm-modal-btn wm-modal-btn-secondary"}).addEventListener("click",()=>{this.close(),this.onEdit()}),m.createEl("button",{text:"Recalculate Defaults",cls:"wm-modal-btn wm-modal-btn-primary"}).addEventListener("click",()=>{let v=w.estimate(this.profile.answers);this.close(),this.onRecalculate(v)}),m.createEl("button",{text:"Close",cls:"wm-modal-btn wm-modal-btn-close"}).addEventListener("click",()=>{this.close()})}onClose(){let{contentEl:t}=this;t.empty()}addAnswerRow(t,e,i){let n=t.createDiv("wm-answer-row");n.createEl("div",{text:e,cls:"wm-answer-label"}),n.createEl("div",{text:i,cls:"wm-answer-value"})}addRecCard(t,e,i,n){let r=t.createDiv("wm-rec-card");r.createEl("div",{text:n,cls:"wm-rec-icon"}),r.createEl("div",{text:i,cls:"wm-rec-value"}),r.createEl("div",{text:e,cls:"wm-rec-label"})}getPurposeLabel(t){return{express:"\u{1F4DD} Self-Expression",monetize:"\u{1F4B0} Monetization",fun:"\u{1F389} Fun & Creativity",skill:"\u{1F4DA} Skill Development",custom:"\u270F\uFE0F Custom"}[t]||t}};var C=require("obsidian");var P=class{constructor(){this.activeToasts=new Set;this.maxToasts=3}showToast(s){let{message:t,variant:e="info",duration:i=2500,progress:n}=s;if(this.activeToasts.size>=this.maxToasts){let l=Array.from(this.activeToasts)[0];this.removeToast(l)}let r=document.createElement("div");r.className=`wm-toast wm-${e}`,Object.assign(r.style,{position:"fixed",right:"16px",bottom:this.getBottomPosition()+"px",padding:"12px 16px",borderRadius:"10px",fontSize:"13px",zIndex:"9999",background:this.getBackgroundColor(e),color:"#fff",boxShadow:"0 6px 18px rgba(0,0,0,0.2)",transition:"all 0.3s ease",opacity:"0",transform:"translateX(400px)",minWidth:"250px",maxWidth:"400px"});let a=document.createElement("div");if(a.textContent=t,a.style.marginBottom=n!==void 0?"8px":"0",r.appendChild(a),n!==void 0){let l=document.createElement("div");Object.assign(l.style,{width:"100%",height:"4px",backgroundColor:"rgba(255,255,255,0.2)",borderRadius:"2px",overflow:"hidden"});let o=document.createElement("div");Object.assign(o.style,{width:`${Math.min(100,Math.max(0,n))}%`,height:"100%",backgroundColor:"rgba(255,255,255,0.8)",borderRadius:"2px",transition:"width 0.3s ease"}),l.appendChild(o),r.appendChild(l)}document.body.appendChild(r),this.activeToasts.add(r),requestAnimationFrame(()=>{r.style.opacity="0.98",r.style.transform="translateX(0)"}),setTimeout(()=>{this.removeToast(r)},i)}removeToast(s){this.activeToasts.has(s)&&(s.style.opacity="0",s.style.transform="translateX(400px)",setTimeout(()=>{s.parentElement&&s.parentElement.removeChild(s),this.activeToasts.delete(s)},300))}getBottomPosition(){let i=this.activeToasts.size;return 16+(60+10)*i}getBackgroundColor(s){switch(s){case"success":return"#1f8a50";case"warn":return"#b85c00";case"break":return"#586e75";case"milestone":return"#6b46c1";case"info":default:return"#3a6ea5"}}info(s,t){this.showToast({message:s,variant:"info",duration:t})}success(s,t){this.showToast({message:s,variant:"success",duration:t})}warn(s,t){this.showToast({message:s,variant:"warn",duration:t})}break(s,t){this.showToast({message:s,variant:"break",duration:t})}milestone(s,t){this.showToast({message:s,variant:"milestone",duration:t||5e3})}progress(s,t,e="info"){this.showToast({message:s,variant:e,progress:t,duration:3e3})}cleanup(){this.activeToasts.forEach(s=>this.removeToast(s))}};var E=class{constructor(s){this.currentSession=null;this.charCountInterval=null;this.timeInterval=null;this.sessionStartContent="";this.activeProfile=null;this.pomodoroPhase=null;this.pomodoroStartTime=0;this.plugin=s,this.toastManager=new P}setActiveProfile(s){this.activeProfile=s}getActiveProfile(){return this.activeProfile}startSession(s,t){this.currentSession&&this.endSession();let e=t||this.activeProfile;if(!e){new C.Notice("No active profile. Please run onboarding first.");return}this.activeProfile=e;let i=`session-${Date.now()}`;this.currentSession={id:i,profileId:e.id,notePath:s,startedAt:Date.now(),chars:0,status:"ongoing"},this.captureInitialContent(s),e.recommendation.target.type==="words"?this.startCharTracking():this.startTimeTracking(),e.recommendation.sessionLengthMin&&e.recommendation.sessionLengthMin>0&&this.startPomodoro(),this.showStartToast()}async captureInitialContent(s){try{let t=this.plugin.app.vault.getAbstractFileByPath(s);if(t instanceof C.TFile){let e=await this.plugin.app.vault.read(t);this.sessionStartContent=e}}catch(t){console.error("Failed to capture initial content:",t),this.sessionStartContent=""}}startCharTracking(){this.charCountInterval&&window.clearInterval(this.charCountInterval),this.charCountInterval=window.setInterval(()=>{this.updateCharCount()},1e3),this.plugin.registerInterval(this.charCountInterval)}startTimeTracking(){this.timeInterval&&window.clearInterval(this.timeInterval),this.timeInterval=window.setInterval(()=>{this.checkTimeProgress()},1e3),this.plugin.registerInterval(this.timeInterval)}async updateCharCount(){var t,e;if(!this.currentSession||!this.currentSession.notePath)return;let s=this.plugin.app.vault.getAbstractFileByPath(this.currentSession.notePath);if(s instanceof C.TFile)try{let i=await this.plugin.app.vault.read(s),n=this.sessionStartContent.length,r=i.length,a=Math.max(0,r-n);this.currentSession.chars=a,((t=this.activeProfile)==null?void 0:t.recommendation.target.type)==="words"&&this.checkCharMilestones(a,this.activeProfile.recommendation.target.value),((e=this.activeProfile)==null?void 0:e.recommendation.target.type)==="words"&&a>=this.activeProfile.recommendation.target.value&&this.completeSession()}catch(i){console.error("Failed to read file:",i)}}checkTimeProgress(){if(!(!this.currentSession||!this.activeProfile)&&this.activeProfile.recommendation.target.type==="minutes"){let s=(Date.now()-this.currentSession.startedAt)/6e4,t=this.activeProfile.recommendation.target.value;this.checkTimeMilestones(s,t),s>=t&&this.completeSession()}}checkCharMilestones(s,t){if(!this.activeProfile)return;let e=s/t*100,i=this.activeProfile.notifyLevel||"mid";e>=50&&e<51&&i!=="low"&&this.toastManager.progress("Halfway there! Keep going! \u{1F680}",50,"info"),e>=75&&e<76&&i==="high"&&this.toastManager.progress("Almost done! 75% complete! \u{1F4AA}",75,"success"),e>=90&&e<91&&this.toastManager.progress("Final push! 90% there! \u{1F3AF}",90,"milestone")}checkTimeMilestones(s,t){if(!this.activeProfile)return;let e=s/t*100,i=this.activeProfile.notifyLevel||"mid";e>=50&&e<50.3&&i!=="low"&&this.toastManager.info("Halfway through your session! \u23F1\uFE0F"),e>=90&&e<90.3&&this.toastManager.warn("Last minute! Finish strong! \u{1F3C1}")}startPomodoro(){var t;if(!((t=this.activeProfile)!=null&&t.recommendation.sessionLengthMin))return;this.pomodoroPhase="focus",this.pomodoroStartTime=Date.now();let s=this.activeProfile.recommendation.sessionLengthMin*6e4;setTimeout(()=>{this.onPomodoroPhaseEnd()},s)}onPomodoroPhaseEnd(){if(this.activeProfile)if(this.pomodoroPhase==="focus"){let s=this.activeProfile.breakMin||5;this.toastManager.break(`Time for a ${s} minute break! \u{1F31F}`,5e3),this.pomodoroPhase="break",this.pomodoroStartTime=Date.now();let t=s*6e4;setTimeout(()=>{this.onPomodoroPhaseEnd()},t)}else this.toastManager.info("Break over! Back to writing! \u270D\uFE0F"),this.startPomodoro()}pauseSession(){this.currentSession&&(this.charCountInterval&&(window.clearInterval(this.charCountInterval),this.charCountInterval=null),this.timeInterval&&(window.clearInterval(this.timeInterval),this.timeInterval=null),this.toastManager.info("Session paused \u23F8\uFE0F"))}resumeSession(){!this.currentSession||!this.activeProfile||(this.activeProfile.recommendation.target.type==="words"?this.startCharTracking():this.startTimeTracking(),this.toastManager.success("Session resumed! \u25B6\uFE0F"))}completeSession(){if(!this.currentSession||!this.activeProfile)return;this.currentSession.status="completed",this.currentSession.endedAt=Date.now();let s=Math.round((Date.now()-this.currentSession.startedAt)/6e4);this.saveSession(this.currentSession),this.showCompletionToast(s),this.cleanup()}endSession(){this.currentSession&&(this.currentSession.status="skipped",this.currentSession.endedAt=Date.now(),this.saveSession(this.currentSession),this.toastManager.info("Session ended"),this.cleanup())}skipSession(){this.currentSession&&(this.currentSession.status="skipped",this.currentSession.endedAt=Date.now(),this.saveSession(this.currentSession),this.toastManager.info("Session skipped"),this.cleanup())}getCurrentSession(){return this.currentSession}getSessionProgress(){if(!this.currentSession||!this.activeProfile)return 0;if(this.activeProfile.recommendation.target.type==="words"){let s=(this.currentSession.chars||0)/this.activeProfile.recommendation.target.value;return Math.min(100,s*100)}else{let t=(Date.now()-this.currentSession.startedAt)/6e4/this.activeProfile.recommendation.target.value;return Math.min(100,t*100)}}showStartToast(){if(!this.activeProfile)return;let s="Session started! ";this.activeProfile.recommendation.target.type==="words"?s+=`Target: ${this.activeProfile.recommendation.target.value} words`:s+=`Target: ${this.activeProfile.recommendation.target.value} minutes`,(this.activeProfile.notifyLevel||"mid")!=="low"&&this.toastManager.success(s,3e3)}showCompletionToast(s){if(!this.activeProfile||!this.currentSession)return;let t="\u{1F389} Session complete! ";this.activeProfile.recommendation.target.type==="words"?t+=`${this.currentSession.chars} characters in ${s} minutes`:t+=`${s} minutes of focused writing`,this.toastManager.milestone(t,5e3)}async saveSession(s){this.plugin.sessionLogs.push(s),await this.plugin.savePurposeData()}cleanup(){this.charCountInterval&&(window.clearInterval(this.charCountInterval),this.charCountInterval=null),this.timeInterval&&(window.clearInterval(this.timeInterval),this.timeInterval=null),this.currentSession=null,this.sessionStartContent="",this.pomodoroPhase=null}destroy(){this.cleanup(),this.toastManager.cleanup()}};var x=class{constructor(s,t,e){this.profile=s,this.sessions=t,this.toastManager=e}getCurrentWeekPlan(){let s=this.getWeekStart(),e=this.getWeekSessions().filter(i=>i.status==="completed").length;return{weekStart:s,targetSessions:this.profile.recommendation.sessionsPerWeek,completedSessions:e,preferredDays:this.profile.answers.preferredDays||[]}}shouldNudge(){let s=new Date().getDay(),t=this.getCurrentWeekPlan();if(this.profile.answers.preferredDays&&this.profile.answers.preferredDays.length>0&&!this.profile.answers.preferredDays.includes(s)||this.hasWrittenToday()||t.completedSessions>=t.targetSessions)return!1;if(this.profile.answers.preferredTime){let e=new Date,i=`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`,n=this.timeToMinutes(this.profile.answers.preferredTime),r=this.timeToMinutes(i);if(Math.abs(r-n)>30)return!1}return!0}showNudge(){let s=this.getCurrentWeekPlan(),t=s.targetSessions-s.completedSessions,e="\u{1F4DD} Time to write! ";t===1?e+="One more session to complete your weekly goal!":e+=`${t} sessions left this week.`,this.profile.recommendation.target.type==="words"?e+=` Target: ${this.profile.recommendation.target.value} words.`:e+=` Target: ${this.profile.recommendation.target.value} minutes.`,this.toastManager.info(e,5e3)}showWeeklySummary(){let s=this.getCurrentWeekPlan(),t=this.getWeekSessions(),e=t.reduce((r,a)=>r+(a.chars||0),0),i=t.length>0?Math.round(e/t.length):0,n=`\u{1F4CA} Weekly Summary:
`;n+=`\u2705 ${s.completedSessions}/${s.targetSessions} sessions
`,n+=`\u{1F4DD} ${e} total characters
`,t.length>0&&(n+=`\u{1F4C8} ${i} avg per session`),s.completedSessions>=s.targetSessions?this.toastManager.milestone(n+`
\u{1F389} Goal achieved!`,7e3):this.toastManager.info(n,5e3)}getRemainingSessionsThisWeek(){let s=this.getCurrentWeekPlan();return Math.max(0,s.targetSessions-s.completedSessions)}getNextPreferredDay(){if(!this.profile.answers.preferredDays||this.profile.answers.preferredDays.length===0)return null;let s=new Date().getDay(),t=[...this.profile.answers.preferredDays].sort((i,n)=>i-n),e=t.find(i=>i>s);return e!==void 0?this.dayName(e):this.dayName(t[0])+" (next week)"}getWeekProgress(){let s=this.getCurrentWeekPlan();return s.targetSessions>0?s.completedSessions/s.targetSessions*100:0}getWeekStart(){let s=new Date,t=s.getDay(),e=s.getDate()-t;return new Date(s.setDate(e)).toISOString().split("T")[0]}getWeekSessions(){let s=new Date(this.getWeekStart()),t=new Date(s);return t.setDate(t.getDate()+7),this.sessions.filter(e=>{let i=new Date(e.startedAt);return i>=s&&i<t&&e.profileId===this.profile.id})}hasWrittenToday(){let s=new Date().toISOString().split("T")[0];return this.sessions.filter(e=>new Date(e.startedAt).toISOString().split("T")[0]===s&&e.status==="completed"&&e.profileId===this.profile.id).length>0}timeToMinutes(s){let[t,e]=s.split(":").map(Number);return t*60+e}dayName(s){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][s]}};var p=require("obsidian");var et=require("obsidian"),F=class extends et.Modal{constructor(t,e){super(t);this.profile=e}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("wm-purpose-modal");let e=t.createDiv("wm-modal-header");e.createEl("h2",{text:"Your Writing Purpose"}),e.createEl("p",{text:"Overview of your writing goals and preferences",cls:"wm-modal-subtitle"});let i=t.createDiv("wm-modal-section");i.createEl("h3",{text:"\u{1F4DD} Why You Write"});let n=i.createDiv("wm-purpose-card"),r=this.getPurposeLabel(this.profile.answers.purpose);n.createEl("div",{text:r,cls:"wm-purpose-label"}),this.profile.answers.customPurpose&&n.createEl("div",{text:this.profile.answers.customPurpose,cls:"wm-purpose-custom"});let a=t.createDiv("wm-modal-section");if(a.createEl("h3",{text:"\u{1F3AF} What You Want to Achieve"}),a.createDiv("wm-outcome-card").createEl("div",{text:this.profile.answers.outcome||"Not specified",cls:"wm-outcome-text"}),this.profile.answers.finalGoal){let S=t.createDiv("wm-modal-section");S.createEl("h3",{text:"\u{1F3C6} Your Final Writing Goal"}),S.createDiv("wm-outcome-card").createEl("div",{text:this.profile.answers.finalGoal,cls:"wm-outcome-text"})}let o=t.createDiv("wm-modal-section");o.createEl("h3",{text:"\u{1F4CA} How You Track Progress"});let c=o.createDiv("wm-tracking-card"),u=this.profile.answers.unitPref==="words"?"\u{1F4CA}":"\u23F1\uFE0F",m=this.profile.answers.unitPref==="words"?"Word Count":"Time-Based";if(c.createEl("div",{text:u,cls:"wm-tracking-icon"}),c.createEl("div",{text:m,cls:"wm-tracking-label"}),this.profile.answers.targetHint){let S=this.profile.answers.unitPref==="words"?`${this.profile.answers.targetHint} words (your hint)`:`${this.profile.answers.targetHint} minutes (your hint)`;c.createEl("div",{text:S,cls:"wm-tracking-hint"})}t.createDiv("wm-modal-actions").createEl("button",{text:"Close",cls:"wm-modal-btn wm-modal-btn-primary"}).addEventListener("click",()=>{this.close()})}onClose(){let{contentEl:t}=this;t.empty()}getPurposeLabel(t){return{express:"\u{1F4DD} Self-Expression",monetize:"\u{1F4B0} Monetization",fun:"\u{1F389} Fun & Creativity",skill:"\u{1F4DA} Skill Development",custom:"\u270F\uFE0F Custom"}[t]||t}};var $=class extends p.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;if(t.empty(),t.createEl("h2",{text:"Writing Momentum Settings"}),t.createEl("h3",{text:"\u{1F4CB} Writing Profile (Steps 1-3)"}),this.plugin.activeProfile){let o=t.createDiv("wm-pre-qna-summary"),c=o.createDiv("wm-qna-row");c.createEl("span",{text:"1. Purpose:",cls:"wm-qna-label"}),c.createEl("span",{text:this.getPurposeLabel(this.plugin.activeProfile.answers.purpose),cls:"wm-qna-value"});let u=o.createDiv("wm-qna-row");if(u.createEl("span",{text:"2. What you want:",cls:"wm-qna-label"}),u.createEl("span",{text:this.plugin.activeProfile.answers.outcome||"Not specified",cls:"wm-qna-value"}),this.plugin.activeProfile.answers.finalGoal){let d=o.createDiv("wm-qna-row");d.createEl("span",{text:"3. Final goal:",cls:"wm-qna-label"}),d.createEl("span",{text:this.plugin.activeProfile.answers.finalGoal,cls:"wm-qna-value"})}let m=t.createDiv("wm-pre-qna-actions");new p.Setting(m).setName("View detailed profile").setDesc("See full writing purpose modal").addButton(d=>d.setButtonText("View Details").onClick(()=>{this.plugin.activeProfile&&new F(this.app,this.plugin.activeProfile).open()})),new p.Setting(m).setName("Reset profile").setDesc("Clear all answers and start over").addButton(d=>d.setButtonText("Reset").setClass("mod-warning").onClick(async()=>{confirm("Are you sure you want to reset your writing profile? This will clear all your answers.")&&(this.plugin.activeProfile=null,this.plugin.sessionLogs=[],await this.plugin.savePurposeData(),this.plugin.purposeSessionManager&&(this.plugin.purposeSessionManager.destroy(),this.plugin.purposeSessionManager=null),this.display())}))}else new p.Setting(t).setName("Create writing profile").setDesc("Answer questions to set up your writing goals").addButton(o=>o.setButtonText("Start Onboarding").setClass("mod-cta").onClick(()=>{new T(this.app,async c=>{this.plugin.activeProfile=c,await this.plugin.savePurposeData(),this.display()}).open()}));t.createEl("h3",{text:"\u2699\uFE0F General Settings"}),this.plugin.settings.ui||(this.plugin.settings.ui={showStatusBar:!1,showRibbonIcon:!1,notifications:!1}),new p.Setting(t).setName("Show status bar").setDesc("Display writing progress in the status bar").addToggle(o=>o.setValue(this.plugin.settings.ui.showStatusBar).onChange(async c=>{this.plugin.settings.ui.showStatusBar=c,await this.plugin.saveSettings()})),new p.Setting(t).setName("Show ribbon icon").setDesc("Display plugin icon in the left ribbon").addToggle(o=>o.setValue(this.plugin.settings.ui.showRibbonIcon).onChange(async c=>{this.plugin.settings.ui.showRibbonIcon=c,await this.plugin.saveSettings()})),new p.Setting(t).setName("Enable notifications").setDesc("Show notifications for achievements and reminders").addToggle(o=>o.setValue(this.plugin.settings.ui.notifications).onChange(async c=>{this.plugin.settings.ui.notifications=c,await this.plugin.saveSettings()})),t.createEl("h3",{text:"\u23F0 Reminders"}),new p.Setting(t).setName("Default reminder time").setDesc("Time for daily writing reminders (24-hour format)").addText(o=>{var c;return o.setPlaceholder("21:00").setValue(((c=this.plugin.settings.reminders[0])==null?void 0:c.time)||"21:00").onChange(async u=>{this.plugin.settings.reminders.length===0?this.plugin.settings.reminders.push({id:"default-reminder",days:[1,2,3,4,5,6,0],time:u,enabled:!0}):this.plugin.settings.reminders[0].time=u,await this.plugin.saveSettings()})}),t.createEl("h3",{text:"\u{1F4DD} Template Management"});let e=t.createDiv("template-reference");e.createEl("h4",{text:"Available Variables"});let i=e.createEl("ul");["{{date}} - Current date (format configurable)","{{time}} - Current time (HH:MM)","{{weekday}} - Day of the week","{{vault}} - Your vault name","{{random_prompt}} - Random writing prompt","{{title}} - Custom title (if provided)"].forEach(o=>{let c=i.createEl("li");c.textContent=o});let r=this.plugin.templateManager.getActiveTemplate();new p.Setting(t).setName("Active template").setDesc("Select which template to use for new notes").addDropdown(o=>{this.plugin.templateManager.getAllTemplates().forEach(u=>{o.addOption(u.id,u.name)}),o.setValue((r==null?void 0:r.id)||""),o.onChange(async u=>{await this.plugin.templateManager.setActiveTemplate(u),this.display()})});let a=t.createDiv("template-list-header");a.createEl("h4",{text:"Your Templates"}),new p.Setting(a).addButton(o=>o.setButtonText("+ New Template").setClass("mod-cta").onClick(()=>{new O(this.app,this.plugin,null,()=>{this.display()}).open()})).addButton(o=>o.setButtonText("Import").onClick(()=>{new J(this.app,this.plugin,()=>{this.display()}).open()})).addButton(o=>o.setButtonText("Export All").onClick(()=>{let c=this.plugin.templateManager.exportTemplates(),u=new Blob([c],{type:"application/json"}),m=URL.createObjectURL(u),d=document.createElement("a");d.href=m,d.download=`writing-momentum-templates-${new Date().toISOString().split("T")[0]}.json`,d.click(),new p.Notice("Templates exported")}));let l=t.createDiv("template-list-container");this.renderTemplateList(l),t.createEl("h3",{text:"\u{1F4C1} File Paths"}),this.plugin.settings.paths||(this.plugin.settings.paths={prompts:""}),new p.Setting(t).setName("Prompts file").setDesc("File containing writing prompts").addText(o=>o.setPlaceholder(".writing-momentum/prompts.md").setValue(this.plugin.settings.paths.prompts||"").onChange(async c=>{this.plugin.settings.paths.prompts=c,await this.plugin.saveSettings()})),t.createEl("h3",{text:"\u{1F4BE} Data Management"}),new p.Setting(t).setName("Export data").setDesc("Export all writing sessions and streak data").addButton(o=>o.setButtonText("Export").onClick(()=>{let c=this.plugin.dataManager.exportData(),u=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),m=URL.createObjectURL(u),d=document.createElement("a");d.href=m,d.download=`writing-momentum-export-${new Date().toISOString().split("T")[0]}.json`,d.click()}))}getPurposeLabel(t){return{express:"\u{1F4DD} Self-Expression",monetize:"\u{1F4B0} Monetization",fun:"\u{1F389} Fun & Creativity",skill:"\u{1F4DA} Skill Development",custom:"\u270F\uFE0F Custom"}[t]||t}renderTemplateList(t){t.empty();let e=this.plugin.templateManager.getAllTemplates(),i=e.filter(r=>r.isBuiltIn),n=e.filter(r=>!r.isBuiltIn);i.length>0&&(t.createEl("h5",{text:"Built-in Templates",cls:"template-section-header"}),i.forEach(r=>{this.renderTemplateItem(t,r,!0)})),n.length>0&&(t.createEl("h5",{text:"Custom Templates",cls:"template-section-header"}),n.forEach(r=>{this.renderTemplateItem(t,r,!1)})),n.length===0&&t.createDiv("template-empty-state").createEl("p",{text:'No custom templates yet. Click "New Template" to create one.'})}renderTemplateItem(t,e,i){let n=new p.Setting(t).setName(e.name).setDesc(e.description||`Title: ${e.titlePattern}`);n.addButton(r=>r.setButtonText("Preview").setTooltip("View template content").onClick(()=>{new Y(this.app,e).open()})),i?n.addButton(r=>r.setIcon("copy").setTooltip("Duplicate to customize").onClick(async()=>{try{let a=await this.plugin.templateManager.duplicateTemplate(e.id);new p.Notice(`Created "${a.name}". Edit it to customize.`),this.display()}catch(a){new p.Notice(`Error: ${a.message}`)}})):(n.addButton(r=>r.setIcon("pencil").setTooltip("Edit template").onClick(()=>{new O(this.app,this.plugin,e,()=>{this.display()}).open()})),n.addButton(r=>r.setIcon("copy").setTooltip("Duplicate template").onClick(async()=>{try{await this.plugin.templateManager.duplicateTemplate(e.id),this.display()}catch(a){new p.Notice(`Error: ${a.message}`)}})),n.addButton(r=>r.setIcon("trash").setTooltip("Delete template").setClass("mod-warning").onClick(async()=>{if(confirm(`Delete template "${e.name}"?`))try{await this.plugin.templateManager.deleteTemplate(e.id),this.display()}catch(l){new p.Notice(`Error: ${l.message}`)}})))}},O=class extends p.Modal{constructor(t,e,i,n){super(t);this.plugin=e,this.template=i,this.onSave=n}onOpen(){var l,o;let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:this.template?"Edit Template":"Create New Template"}),new p.Setting(t).setName("Template name").setDesc("A descriptive name for this template").addText(c=>{var u;this.nameInput=c.inputEl,c.setValue(((u=this.template)==null?void 0:u.name)||"").setPlaceholder("My Custom Template")}),new p.Setting(t).setName("Category").setDesc("Organize your template").addDropdown(c=>{var u;this.categoryDropdown=c.selectEl,c.addOption("custom","Custom").addOption("daily","Daily Journal").addOption("blog","Blog Post").addOption("fiction","Fiction Writing").setValue(((u=this.template)==null?void 0:u.category)||"custom")}),new p.Setting(t).setName("Description").setDesc("Optional description").addText(c=>{var u;this.descriptionInput=c.inputEl,c.setValue(((u=this.template)==null?void 0:u.description)||"").setPlaceholder("What is this template for?")});let e=new p.Setting(t).setName("Title pattern").setDesc("Pattern for the note title. Use {{date}}, {{time}}, etc.");this.titlePatternInput=e.controlEl.createEl("input",{type:"text",placeholder:"{{date}} - Writing Session",cls:"template-title-input"}),this.titlePatternInput.value=((l=this.template)==null?void 0:l.titlePattern)||"";let i=t.createDiv("template-content-setting");i.createEl("label",{text:"Template Content",cls:"setting-item-name"}),i.createEl("div",{text:"Use variables like {{date}}, {{time}}, {{random_prompt}}, etc.",cls:"setting-item-description"}),this.contentTextarea=i.createEl("textarea",{placeholder:`# {{title}}

## Prompt
{{random_prompt}}

## Writing


---
*Written on {{weekday}} at {{time}}*`,cls:"template-content-textarea"}),this.contentTextarea.value=((o=this.template)==null?void 0:o.content)||"",this.contentTextarea.rows=15;let n=t.createDiv("template-modal-buttons");n.createEl("button",{text:this.template?"Save Changes":"Create Template",cls:"mod-cta"}).addEventListener("click",()=>this.handleSave()),n.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close())}async handleSave(){let t=this.nameInput.value.trim(),e=this.titlePatternInput.value.trim(),i=this.contentTextarea.value.trim(),n=this.descriptionInput.value.trim(),r=this.categoryDropdown.value,a=this.plugin.templateManager.validateTemplate(e,i);if(!a.valid){new p.Notice(`Validation errors:
${a.errors.join(`
`)}`);return}if(!t){new p.Notice("Please enter a template name");return}try{this.template?await this.plugin.templateManager.updateTemplate(this.template.id,{name:t,titlePattern:e,content:i,description:n||void 0,category:r}):await this.plugin.templateManager.createTemplate(t,e,i,{description:n||void 0,category:r}),this.onSave(),this.close()}catch(l){new p.Notice(`Error: ${l.message}`)}}onClose(){let{contentEl:t}=this;t.empty()}},Y=class extends p.Modal{constructor(t,e){super(t);this.template=e}onOpen(){let{contentEl:t}=this;if(t.empty(),t.createEl("h2",{text:this.template.name}),this.template.description&&t.createEl("p",{text:this.template.description,cls:"template-preview-description"}),t.createEl("h3",{text:"Title Pattern"}),t.createEl("code",{text:this.template.titlePattern,cls:"template-preview-code"}),t.createEl("h3",{text:"Content"}),t.createEl("pre",{cls:"template-preview-content"}).createEl("code",{text:this.template.content}),this.template.variables&&this.template.variables.length>0){t.createEl("h3",{text:"Variables Used"});let n=t.createEl("ul");this.template.variables.forEach(r=>{n.createEl("li",{text:`{{${r}}}`})})}t.createEl("button",{text:"Close",cls:"mod-cta"}).addEventListener("click",()=>this.close())}onClose(){let{contentEl:t}=this;t.empty()}},J=class extends p.Modal{constructor(t,e,i){super(t);this.plugin=e,this.onImport=i}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"Import Templates"}),t.createEl("p",{text:"Paste the exported template JSON below:"});let e=t.createEl("textarea",{placeholder:"Paste template JSON here...",cls:"template-import-textarea"});e.rows=10;let i=t.createDiv("template-modal-buttons");i.createEl("button",{text:"Import",cls:"mod-cta"}).addEventListener("click",async()=>{try{let a=e.value.trim();if(!a){new p.Notice("Please paste template JSON");return}await this.plugin.templateManager.importTemplates(a),this.onImport(),this.close()}catch(a){new p.Notice(`Import failed: ${a.message}`)}}),i.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close())}onClose(){let{contentEl:t}=this;t.empty()}};var z=["What if gravity worked backwards for one day?","Describe a world where colors have sounds","What would you tell your younger self?","If you could have dinner with any historical figure, who would it be and why?","Describe your perfect day in vivid detail","What's the most important lesson you learned recently?","What are you most grateful for right now?","What challenge are you currently facing and how might you overcome it?","What small thing brought you joy today?","What would you do if you weren't afraid?","The old book opened itself to a page that wasn't there yesterday...","She found a letter addressed to her, dated 50 years in the future...","The last person on Earth sat alone in a room. There was a knock at the door...","Every morning, the same stranger waves at you from their window...","You wake up with the ability to hear everyone's thoughts, except one person...","Write about: Transformation","Explore the theme: Hidden connections","Focus on: Unexpected kindness","Consider: The space between words","Reflect on: Moments of change","Describe what you can see from where you're sitting","What sounds do you notice right now?","Write about a memory triggered by a smell","Describe a person you saw today without using their appearance","What's the story behind an object near you?","Write about a time you felt completely understood","Describe the feeling of coming home","What does hope look like to you?","Write about a moment of unexpected courage","Describe the weight of a secret","If time had a texture, what would it feel like?","What color is Monday?","Describe the personality of your favorite room","What would loneliness say if it could speak?","Write about the space between heartbeats"],st=["Mystery","Journey","Discovery","Connection","Solitude","Courage","Change","Memory","Hope","Wonder","Silence","Movement","Light","Shadow","Time","Growth","Healing","Adventure","Home","Freedom","Dreams","Truth","Beauty","Strength","Peace"],H=class extends f.Plugin{constructor(){super(...arguments);this.statusBarItem=null;this.currentSession=null;this.sessionHistory=[];this.wordCountInterval=null;this.isMobile=!1;this.purposeSessionManager=null;this.activeProfile=null;this.sessionLogs=[];this.nudgeInterval=null}async onload(){this.isMobile=this.app.isMobile||!1,await this.loadSettings(),await this.loadSessionHistory(),this.dataManager=new A(this),this.templateEngine=new I(this),this.templateManager=new R(this),this.sessionManager=new L(this),this.reminderScheduler=new M(this),await this.dataManager.loadData(),await this.templateEngine.initialize(),this.randomPrompts=new W(this),this.settings.randomPrompts.enabled&&this.settings.randomPrompts.autoRefresh&&this.randomPrompts.fetchNetworkPrompts().catch(()=>{}),this.toastManager=new P,await this.loadPurposeData(),this.activeProfile?(this.purposeSessionManager=new E(this),this.purposeSessionManager.setActiveProfile(this.activeProfile),this.startNudgeScheduler()):new T(this.app,async t=>{this.activeProfile=t,await this.savePurposeData(),this.purposeSessionManager=new E(this),this.purposeSessionManager.setActiveProfile(t),this.startNudgeScheduler();let e=w.describe(t.recommendation);this.toastManager.success(`Profile created! Defaults set: ${e}`,5e3)}).open(),this.registerView(D,t=>new K(t,this)),(this.settings.ui.showRibbonIcon||this.isMobile)&&this.addRibbonIcon("target","Writing Momentum",()=>{this.openDashboard()}),this.settings.ui.showStatusBar&&(this.statusBarItem=this.addStatusBarItem(),this.updateStatusBar()),this.addCommand({id:"open-dashboard",name:"Open Dashboard",callback:()=>this.openDashboard()}),this.addCommand({id:"start-writing-session",name:"Start Session",callback:()=>this.startQuickSession()}),this.addCommand({id:"complete-session",name:"Complete Session",callback:()=>this.completeSession()}),this.addCommand({id:"quick-note",name:"Create Quick Note",callback:()=>this.createQuickNote()}),this.addCommand({id:"insert-writing-prompt",name:"Insert Prompt",callback:()=>this.insertWritingPrompt()}),this.addCommand({id:"stop-all-timers",name:"Stop All Timers and Alarms",callback:()=>this.stopAllTimers()}),this.addCommand({id:"wm-start-purpose-session",name:"WM: Start Writing Session",callback:()=>{let t=this.app.workspace.getActiveFile();t&&this.purposeSessionManager?this.purposeSessionManager.startSession(t.path):t||this.toastManager.warn("Please open a file to start a session")}}),this.addCommand({id:"wm-pause-session",name:"WM: Pause Session",callback:()=>{this.purposeSessionManager&&this.purposeSessionManager.pauseSession()}}),this.addCommand({id:"wm-resume-session",name:"WM: Resume Session",callback:()=>{this.purposeSessionManager&&this.purposeSessionManager.resumeSession()}}),this.addCommand({id:"wm-complete-session",name:"WM: Complete Session",callback:()=>{this.purposeSessionManager&&this.purposeSessionManager.completeSession()}}),this.addCommand({id:"wm-skip-session",name:"WM: Skip Session",callback:()=>{this.purposeSessionManager&&this.purposeSessionManager.skipSession()}}),this.addCommand({id:"wm-weekly-summary",name:"WM: Show Weekly Summary",callback:()=>{this.activeProfile&&new x(this.activeProfile,this.sessionLogs,this.toastManager).showWeeklySummary()}}),this.addCommand({id:"wm-run-onboarding",name:"WM: Re-run Onboarding",callback:()=>{new T(this.app,async t=>{this.activeProfile=t,await this.savePurposeData(),this.purposeSessionManager&&this.purposeSessionManager.setActiveProfile(t);let e=w.describe(t.recommendation);this.toastManager.success(`Profile updated! ${e}`,4e3)}).open()}}),this.addCommand({id:"wm-view-qa-answers",name:"WM: View Q&A Answers",callback:()=>{if(!this.activeProfile){this.toastManager.warn("No profile found. Please run onboarding first.");return}new B(this.app,this.activeProfile,()=>{new T(this.app,async t=>{this.activeProfile=t,await this.savePurposeData(),this.purposeSessionManager&&this.purposeSessionManager.setActiveProfile(t),this.toastManager.success("Answers updated!",3e3)}).open()},async t=>{if(this.activeProfile){this.activeProfile.recommendation=t,this.activeProfile.updatedAt=Date.now(),await this.savePurposeData();let e=w.describe(t);this.toastManager.success(`Defaults recalculated: ${e}`,4e3)}}).open()}}),this.addCommand({id:"wm-recalculate-defaults",name:"WM: Recalculate Defaults",callback:async()=>{if(!this.activeProfile){this.toastManager.warn("No profile found. Please run onboarding first.");return}let t=w.estimate(this.activeProfile.answers);this.activeProfile.recommendation=t,this.activeProfile.updatedAt=Date.now(),this.activeProfile.overrides=void 0,await this.savePurposeData();let e=w.describe(t);this.toastManager.success(`Defaults recalculated: ${e}`,4e3)}}),this.addSettingTab(new $(this.app,this)),this.registerEvent(this.app.workspace.on("file-open",t=>{t&&t.extension==="md"&&this.checkAutoStartSession(t)}))}onunload(){this.stopAllTimers(),this.purposeSessionManager&&this.purposeSessionManager.destroy(),this.toastManager&&this.toastManager.cleanup(),this.nudgeInterval&&window.clearInterval(this.nudgeInterval)}stopAllTimers(){this.wordCountInterval&&(window.clearInterval(this.wordCountInterval),this.wordCountInterval=null),this.app.workspace.getLeavesOfType(D).forEach(e=>{let i=e.view;i&&i.stopRealTimeUpdates&&i.stopRealTimeUpdates()}),this.currentSession&&this.currentSession.active&&this.completeSession()}async loadSettings(){this.settings=Object.assign({},Z,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async loadPurposeData(){let t=await this.loadData();this.activeProfile=t.writingProfile||null,this.sessionLogs=t.sessionLogs||[]}async savePurposeData(){let t=await this.loadData();t.writingProfile=this.activeProfile,t.sessionLogs=this.sessionLogs,await this.saveData(t)}startNudgeScheduler(){this.nudgeInterval&&window.clearInterval(this.nudgeInterval),this.nudgeInterval=window.setInterval(()=>{if(!this.activeProfile)return;let t=new x(this.activeProfile,this.sessionLogs,this.toastManager);t.shouldNudge()&&t.showNudge()},6e4*15),this.registerInterval(this.nudgeInterval)}refreshDashboard(){let{workspace:t}=this.app,e=t.getLeavesOfType(D);if(e.length>0){let n=e[0].view;n&&n.render&&n.render()}}async loadSessionHistory(){let t=await this.loadData();t!=null&&t.sessionHistory&&(this.sessionHistory=t.sessionHistory)}async saveSessionHistory(){let t=await this.loadData()||{};t.sessionHistory=this.sessionHistory,await this.saveData(t)}getRandomPrompt(){if(this.settings.randomPrompts.enabled&&this.randomPrompts){let t=this.randomPrompts.getRandomNetworkPrompt();if(t)return this.settings.randomPrompts.mixWithLocal&&Math.random()<.5?z[Math.floor(Math.random()*z.length)]:t}return z[Math.floor(Math.random()*z.length)]}getRandomKeyword(){return st[Math.floor(Math.random()*st.length)]}async openDashboard(){let{workspace:t}=this.app,e=t.getLeavesOfType(D)[0];if(!e){if(this.isMobile)e=t.getLeaf(!1);else{let i=t.getRightLeaf(!1);i&&(e=i)}e&&await e.setViewState({type:D,active:!0})}e&&t.revealLeaf(e)}startQuickSession(){let t=this.app.workspace.getActiveFile();t&&(this.currentSession||(this.currentSession={id:`session-${Date.now()}`,startTime:Date.now(),wordCount:0,active:!0,paused:!1,totalPausedDuration:0,filePath:t.path,date:new Date().toISOString().split("T")[0],files:[t.path],completed:!1},this.startWordCountTracking(),this.settings.enableNotifications,this.updateStatusBar(),this.refreshDashboard()))}completeSession(){if(!this.currentSession)return;this.currentSession.active=!1,this.currentSession.endTime=Date.now();let t=Math.round((Date.now()-this.currentSession.startTime)/6e4);if(this.sessionHistory.push({...this.currentSession}),this.saveSessionHistory(),this.settings.enableNotifications){let e=`Session completed! ${this.currentSession.wordCount} words in ${t} minutes \u{1F389}`}this.wordCountInterval&&(window.clearInterval(this.wordCountInterval),this.wordCountInterval=null),this.currentSession=null,this.updateStatusBar(),this.refreshDashboard()}pauseSession(){!this.currentSession||!this.currentSession.active||this.currentSession.paused||(this.currentSession.paused=!0,this.currentSession.pausedTime=Date.now(),this.wordCountInterval&&(window.clearInterval(this.wordCountInterval),this.wordCountInterval=null),this.settings.enableNotifications,this.updateStatusBar())}resumeSession(){!this.currentSession||!this.currentSession.active||!this.currentSession.paused||(this.currentSession.pausedTime&&(this.currentSession.totalPausedDuration+=Date.now()-this.currentSession.pausedTime),this.currentSession.paused=!1,this.currentSession.pausedTime=void 0,this.startWordCountTracking(),this.settings.enableNotifications,this.updateStatusBar())}startWordCountTracking(){this.wordCountInterval&&window.clearInterval(this.wordCountInterval),this.wordCountInterval=window.setInterval(()=>{this.updateWordCount()},5e3),this.registerInterval(this.wordCountInterval)}async updateWordCount(){if(!this.currentSession)return;let t=this.app.vault.getAbstractFileByPath(this.currentSession.filePath);if(t instanceof f.TFile)try{let e=await this.app.vault.read(t),i=this.countWords(e);this.currentSession.wordCount=i,this.updateStatusBar()}catch(e){}}countWords(t){return t.replace(/^---[\s\S]*?---\n?/,"").trim().split(/\s+/).filter(i=>i.length>0).length}updateStatusBar(){if(this.statusBarItem)if(this.currentSession&&this.currentSession.active){let t=Date.now()-this.currentSession.startTime-(this.currentSession.totalPausedDuration||0);this.currentSession.paused&&this.currentSession.pausedTime&&(t-=Date.now()-this.currentSession.pausedTime);let e=Math.round(t/6e4),i=this.currentSession.paused?" \u23F8\uFE0F":"";this.statusBarItem.setText(`\u270D\uFE0F ${this.currentSession.wordCount} words (${e}m)${i}`)}else this.statusBarItem.setText("\u{1F4DD} Ready to write")}checkAutoStartSession(t){}async createQuickNote(){let t=new Date,e=t.toISOString().split("T")[0],i=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(/:/g,"-"),n=`${e} Quick Note ${i}.md`,r=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),a=`# Quick Note - ${e}

What's on your mind?

---

Written at ${r}`;try{let l=n,o=1;for(;this.app.vault.getAbstractFileByPath(l);)l=`${n.replace(".md","")} (${o}).md`,o++;let c=await this.app.vault.create(l,a);await this.app.workspace.getLeaf().openFile(c),this.settings.enableNotifications,setTimeout(()=>this.startQuickSession(),100)}catch(l){new f.Notice(`Failed to create quick note: ${l.message}`)}}async createTemplateNoteAndStartSession(){let t=await this.showTemplateSelectionDialog();if(t)try{let e=this.processTemplate(t.title),i=this.processTemplate(t.template,e),n=this.sanitizeFileName(e)+".md",r=n,a=1;for(;this.app.vault.getAbstractFileByPath(r);)r=`${n.replace(".md","")} (${a}).md`,a++;let l=await this.app.vault.create(r,i);await this.app.workspace.getLeaf().openFile(l),setTimeout(()=>{this.startQuickSession()},100),this.settings.enableNotifications}catch(e){new f.Notice(`Failed to create note: ${e.message}`)}}processTemplate(t,e){let i=new Date,n=i.toISOString().split("T")[0],r=i.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),a=i.toLocaleDateString("en-US",{weekday:"long"}),l=this.getRandomPrompt(),o=t.replace(/\{\{date\}\}/g,n).replace(/\{\{time\}\}/g,r).replace(/\{\{weekday\}\}/g,a).replace(/\{\{vault\}\}/g,this.app.vault.getName()).replace(/\{\{random_prompt\}\}/g,l);return e?o=o.replace(/\{\{title\}\}/g,e):o=o.replace(/\{\{title\}\}/g,"Writing Session"),o}sanitizeFileName(t){return t.replace(/[<>:"/\\|?*]/g,"-").replace(/\s+/g," ").trim()}async showTemplateSelectionDialog(){return new Promise(t=>{let e=this.getAvailableTemplates(),i=document.createElement("div");i.className="template-modal-container";let n=document.createElement("div");n.className="template-selection-dialog";let r=n.createEl("h2",{text:"Choose Writing Template"}),a=n.createEl("p",{text:"Select a template to start your writing session:"}),l=n.createEl("div",{cls:"template-options"}),c=n.createEl("div",{cls:"template-dialog-buttons"}).createEl("button",{text:"Cancel",cls:"cancel-btn"});e.forEach((u,m)=>{let d=l.createEl("div",{cls:"template-option"}),g=d.createEl("h3",{text:u.name}),S=d.createEl("p",{text:u.description});d.addEventListener("click",()=>{document.body.removeChild(i),t(u)})}),c.addEventListener("click",()=>{document.body.removeChild(i),t(null)}),i.addEventListener("click",u=>{u.target===i&&(document.body.removeChild(i),t(null))}),i.appendChild(n),document.body.appendChild(i)})}getAvailableTemplates(){return[{name:"Daily Journal",description:"Structured daily reflection with prompts for events, feelings, and gratitude",title:"{{date}} - Daily Journal",template:`**\u{1F4DD} Today's Writing Session**
*Take a moment to reflect on your day and capture your thoughts.*

## Morning Reflection
{{random_prompt}}

## Today's Events
-
-
-

## Thoughts & Feelings


## Gratitude
1.
2.
3.

---
*Journal entry for {{weekday}}, {{date}} at {{time}}*`},{name:"Creative Writing",description:"Free-form creative writing with inspiration prompt",title:"{{date}} - Creative Writing",template:`**\u2728 Creative Writing Session**
*Let your imagination flow and create something beautiful.*

## Writing Prompt
{{random_prompt}}

## Your Story


---
*Creative session on {{weekday}} at {{time}}*`},{name:"Quick Notes",description:"Fast idea capture and organization",title:"{{time}} - Quick Note",template:`**\u{1F4A1} Quick Idea Capture**
*Capture your thoughts quickly and organize them for later.*

## Main Idea
{{random_prompt}}

## Details


## Next Steps
- [ ]
- [ ]

---
*Note taken {{weekday}} at {{time}}*`},{name:"Project Planning",description:"Structured project planning and task organization",title:"{{date}} - Project Planning",template:`**\u{1F3AF} Project Planning Session**
*Plan your project systematically and set clear goals.*

## Project Goal
{{random_prompt}}

## Overview
**Start Date:** {{date}}
**Status:** Planning

## Tasks
- [ ] Task 1
- [ ] Task 2
- [ ] Task 3

## Timeline


## Resources


---
*Project planned on {{weekday}}, {{date}} at {{time}}*`},{name:"Free Writing",description:"Unstructured writing for stream of consciousness",title:"{{date}} - Free Writing",template:`**\u{1F30A} Free Writing Session**
*Write without stopping, let your thoughts flow naturally.*

## Starting Thought
{{random_prompt}}

## Stream of Consciousness
Write continuously for your target time. Don't worry about grammar, structure, or making sense. Just let your thoughts flow onto the page.




---
*Free writing session {{weekday}} at {{time}}*`}]}async insertWritingPrompt(){let t=this.app.workspace.getActiveViewOfType(f.MarkdownView);if(!t){new f.Notice("No active note to insert prompt into");return}let e=this.getRandomPrompt(),i=[this.getRandomKeyword(),this.getRandomKeyword(),this.getRandomKeyword()],n=`**Writing Prompt:** ${e}

**Keywords:** ${i.join(", ")}

---

`,r=t.editor,a=r.getCursor();r.replaceRange(n,a);let l=n.split(`
`).length;r.setCursor(a.line+l-1,0),this.settings.enableNotifications}},D="writing-momentum-dashboard",K=class extends f.ItemView{constructor(t,e){super(t);this.updateInterval=null;this.plugin=e}getViewType(){return D}getDisplayText(){return"Writing Dashboard"}getIcon(){return"target"}async onOpen(){this.render(),this.startRealTimeUpdates()}async onClose(){this.stopRealTimeUpdates()}startRealTimeUpdates(){this.updateInterval=window.setInterval(()=>{this.updateRealTimeElements()},1e3),this.plugin.registerInterval(this.updateInterval)}stopRealTimeUpdates(){this.updateInterval&&(window.clearInterval(this.updateInterval),this.updateInterval=null)}updateRealTimeElements(){let t=this.containerEl.querySelector(".session-timer");if(t&&this.plugin.currentSession&&this.plugin.currentSession.active){let i=this.plugin.currentSession,n=Date.now()-i.startTime-(i.totalPausedDuration||0);i.paused&&i.pausedTime&&(n-=Date.now()-i.pausedTime);let r=Math.floor(n/36e5),a=Math.floor(n%36e5/6e4),l=Math.floor(n%6e4/1e3),o=r>0?`${r}:${a.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`:`${a}:${l.toString().padStart(2,"0")}`;t.textContent=o}let e=this.containerEl.querySelector(".session-words");e&&this.plugin.currentSession&&this.plugin.currentSession.active&&(e.textContent=this.plugin.currentSession.wordCount.toString())}render(){let t=this.containerEl.children[1];t.empty(),t.addClass("writing-momentum-dashboard"),this.plugin.isMobile&&t.addClass("is-mobile"),t.createEl("div",{cls:"dashboard-header"}).createEl("h2",{text:"Writing Dashboard",cls:"dashboard-title"}),this.renderCurrentSession(t),this.plugin.currentSession&&this.plugin.currentSession.active||this.renderWritingMode(t),this.renderWritingVolumeChart(t)}renderCurrentSession(t){var i;let e=t.createEl("div",{cls:"dashboard-section"});if(this.plugin.currentSession&&this.plugin.currentSession.active){let n=this.plugin.currentSession,r=Date.now()-n.startTime-(n.totalPausedDuration||0);n.paused&&n.pausedTime&&(r-=Date.now()-n.pausedTime);let a=Math.round(r/6e4),l=e.createEl("h3",{text:n.paused?"\u{1F3AF} Current Session (Paused)":"\u{1F3AF} Current Session"});n.paused&&l.addClass("paused-session");let o=e.createEl("div",{cls:"session-stats-grid"}),c=o.createEl("div",{cls:"stat-card"});c.createEl("span",{text:"\u{1F4DD}",cls:"stat-icon"}),c.createEl("span",{text:n.wordCount.toString(),cls:"stat-value session-words"}),c.createEl("span",{text:"Words",cls:"stat-label"});let u=o.createEl("div",{cls:"stat-card"});u.createEl("span",{text:"\u23F1\uFE0F",cls:"stat-icon"});let m=Math.floor(r/36e5),d=Math.floor(r%36e5/6e4),g=Math.floor(r%6e4/1e3),S=m>0?`${m}:${d.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")}`:`${d}:${g.toString().padStart(2,"0")}`;u.createEl("span",{text:S,cls:"stat-value session-timer"}),u.createEl("span",{text:"Time",cls:"stat-label"}),o.createEl("div",{cls:"current-file"}).createEl("span",{text:"\u{1F4C4} "+(((i=n.filePath)==null?void 0:i.split("/").pop())||"Unknown file")});let V=e.createEl("div",{cls:"writing-inspiration"});this.renderWritingInspiration(V);let it=e.createEl("div",{cls:"session-actions"}).createEl("button",{text:"\u2705 Complete Session",cls:"session-btn complete-btn"});it.onclick=()=>{this.plugin.completeSession(),this.render()}}else e.createEl("p",{text:"\u{1F4A4} No active session. Open a markdown file and click the ribbon icon to start!",cls:"no-session-message"})}renderWritingInspiration(t){let e=t.createEl("div",{cls:"prompt-card"}),i=e.createEl("div",{cls:"prompt-header"});i.createEl("span",{text:"\u2728 Writing Inspiration",cls:"prompt-title"});let n=i.createEl("button",{text:"\u{1F3B2}",cls:"prompt-refresh-btn",attr:{title:"Get new inspiration"}}),r=e.createEl("div",{cls:"prompt-text"});r.setText(this.plugin.getRandomPrompt());let a=e.createEl("div",{cls:"keyword-section"});a.createEl("span",{text:"Keywords: ",cls:"keyword-label"});let l=a.createEl("span",{cls:"keywords"});for(let c=0;c<3;c++){let u=l.createEl("span",{text:this.plugin.getRandomKeyword(),cls:"keyword-tag"});c<2&&l.createEl("span",{text:" \u2022 ",cls:"keyword-separator"})}let o=e.createEl("button",{text:"\u{1F4CB} Copy to Clipboard",cls:"copy-prompt-btn"});n.onclick=()=>{r.setText(this.plugin.getRandomPrompt()),l.empty();for(let c=0;c<3;c++){let u=l.createEl("span",{text:this.plugin.getRandomKeyword(),cls:"keyword-tag"});c<2&&l.createEl("span",{text:" \u2022 ",cls:"keyword-separator"})}},o.onclick=async()=>{let c=r.textContent||"",u=Array.from(l.querySelectorAll(".keyword-tag")).map(d=>d.textContent).join(", "),m=`${c}

Keywords: ${u}`;try{await navigator.clipboard.writeText(m),o.setText("\u2705 Copied!"),setTimeout(()=>{o.setText("\u{1F4CB} Copy to Clipboard")},2e3)}catch(d){let g=document.createElement("textarea");g.value=m,document.body.appendChild(g),g.select(),document.execCommand("copy"),document.body.removeChild(g),o.setText("\u2705 Copied!"),setTimeout(()=>{o.setText("\u{1F4CB} Copy to Clipboard")},2e3)}}}renderWritingMode(t){let e=t.createEl("div",{cls:"dashboard-section"});e.createEl("h3",{text:"Writing Mode"});let n=e.createEl("div",{cls:"action-buttons"}).createEl("button",{text:"\u{1F680} Start Session",cls:"action-btn start-session-btn"});n.onclick=async()=>{await this.plugin.createTemplateNoteAndStartSession()}}renderWritingVolumeChart(t){let e=t.createEl("div",{cls:"dashboard-section"});e.createEl("h3",{text:"Writing Volume"});let i=e.createEl("div",{cls:"chart-container"});this.renderWeeklyChart(i),this.renderMonthlyChart(i),this.renderVolumeTotals(i)}renderWeeklyChart(t){let e=t.createEl("div",{cls:"weekly-chart"});e.createEl("h4",{text:"Last 7 Days"});let i=e.createEl("div",{cls:"bar-chart"}),n=this.getWeeklyData(),r=Math.max(...n.map(a=>a.words),100);n.forEach((a,l)=>{let o=i.createEl("div",{cls:"bar-container"});o.createEl("div",{cls:"bar-label"}).setText(a.label);let u=o.createEl("div",{cls:"bar"}),m=Math.max(a.words/r*100,2),d=Math.min(Math.round(m/5)*5,100);u.addClass(`bar-height-${d}`),u.addClass(a.words>0?"has-data":"no-data"),u.title=`${a.words} words`,a.words>0&&o.createEl("div",{cls:"word-count"}).setText(a.words.toString())})}renderMonthlyChart(t){let e=t.createEl("div",{cls:"monthly-chart"});e.createEl("h4",{text:"Last 30 Days"});let i=e.createEl("div",{cls:"line-chart"}),n=this.getMonthlyData(),r=Math.max(...n.map(l=>l.words),100),a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("class","chart-svg"),a.setAttribute("width","100%"),a.setAttribute("height","120"),a.setAttribute("viewBox","0 0 400 120"),this.createSVGPath(a,n,r),this.createSVGDots(a,n,r),i.appendChild(a)}renderVolumeTotals(t){let e=t.createEl("div",{cls:"volume-totals"}),i=this.getWeeklyData().reduce((l,o)=>l+o.words,0),n=this.getMonthlyData().reduce((l,o)=>l+o.words,0),r=e.createEl("div",{cls:"volume-card"});r.createEl("div",{text:i.toString(),cls:"volume-number"}),r.createEl("div",{text:"Words This Week",cls:"volume-label"});let a=e.createEl("div",{cls:"volume-card"});a.createEl("div",{text:n.toString(),cls:"volume-number"}),a.createEl("div",{text:"Words This Month",cls:"volume-label"})}createSVGPath(t,e,i){let n="";e.forEach((a,l)=>{let o=l/(e.length-1)*380+10,c=100-a.words/i*80;n+=(l===0?"M":"L")+` ${o} ${c}`});let r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d",n),r.setAttribute("fill","none"),r.setAttribute("stroke","var(--interactive-accent)"),r.setAttribute("stroke-width","2"),r.setAttribute("class","chart-svg-path"),t.appendChild(r)}createSVGDots(t,e,i){e.forEach((n,r)=>{if(n.words>0){let a=r/(e.length-1)*380+10,l=100-n.words/i*80,o=document.createElementNS("http://www.w3.org/2000/svg","circle");o.setAttribute("cx",a.toString()),o.setAttribute("cy",l.toString()),o.setAttribute("r","3"),o.setAttribute("fill","var(--interactive-accent)"),o.setAttribute("class","chart-svg-circle");let c=document.createElementNS("http://www.w3.org/2000/svg","title");c.textContent=`${n.date}: ${n.words} words`,o.appendChild(c),t.appendChild(o)}})}getWeeklyData(){let t=[],e=new Date;for(let i=6;i>=0;i--){let n=new Date(e);n.setDate(e.getDate()-i);let r=n.toISOString().split("T")[0],a=this.plugin.sessionHistory.filter(l=>l.date===r&&l.endTime).reduce((l,o)=>l+o.wordCount,0);t.push({date:r,label:n.toLocaleDateString("en-US",{weekday:"short"}),words:a})}return t}getMonthlyData(){let t=[],e=new Date;for(let i=29;i>=0;i--){let n=new Date(e);n.setDate(e.getDate()-i);let r=n.toISOString().split("T")[0],a=this.plugin.sessionHistory.filter(l=>l.date===r&&l.endTime).reduce((l,o)=>l+o.wordCount,0);t.push({date:r,words:a})}return t}refresh(){this.render()}};
